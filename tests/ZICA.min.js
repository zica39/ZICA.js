var State;function mlFunction(t,e,i,n,o,a,s,r,h){var c,l=[],d=(t=(t=String(t)).replace(/\r/g,"")).split("\n");for(c=0;c<d.length;c++)c&&l.push("\n"),l=l.concat(d[c].split(" "));var u,m=this.measureText(" ").width,p=[],A=0,y=0;for(p[A]={},p[A].Words=[],c=0;c<l.length;){var C=l[c];if("\n"==C)p[A].EndParagraph=!0,y=0,p[++A]={},p[A].Words=[],c++;else if((u={}).l=this.measureText(C).width,0===y){for(;u.l>n;)C=C.slice(0,C.length-1),u.l=this.measureText(C).width;if(u.word=C,p[A].Words.push(u),y=u.l,C!=l[c]){if(""===C)return;l[c]=l[c].slice(C.length,l[c].length)}else c++}else y+m+u.l>n?(p[A].EndParagraph=!1,y=0,p[++A]={},p[A].Words=[]):(u.word=C,p[A].Words.push(u),y+=m+u.l,c++)}0===y&&p.pop(),p[A]&&(p[A].EndParagraph=!0);for(var g,f=r*p.length;f>o;)p.pop(),f=r*p.length;g="bottom"==s?i+o-f+r:"center"==s?i+o/2-f/2+r:i+r;var T=this.textAlign;this.textAlign="left";var S=0;for(var I in p)if(p.hasOwnProperty(I)){var v,w,Z=0;for(u in p[I].Words)p[I].Words.hasOwnProperty(u)&&(Z+=p[I].Words[u].l);for(u in"center"==a?(w=m,v=e+n/2-(Z+m*(p[I].Words.length-1))/2):"justify"!=a||p[I].EndParagraph?"right"==a?(v=e+n-(Z+m*(p[I].Words.length-1)),w=m):(v=e,w=m):(v=e,w=(n-Z)/(p[I].Words.length-1)),p[I].Words)p[I].Words.hasOwnProperty(u)&&("strokeText"!=h&&"fillStrokeText"!=h||this.strokeText(p[I].Words[u].word,v,g),"fillText"!=h&&"fillStrokeText"!=h||this.fillText(p[I].Words[u].word,v,g),v+=p[I].Words[u].l+w);S=Math.max(S,v),g+=r}return this.textAlign=T,{width:S,height:f}}ZICA={version:"0.1",author:"Zeljko Ivanovic"},ZICA.boxIntersection=function(t,e){return t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.y+t.height>e.y},ZICA.clamp=function(t,e,i){return t<e?e:t>i?i:t},ZICA.Keys=["Left Mouse Button","Right Mouse Button","Escape","Enter","Tab","Shift","Control","Space","Left","Up","Right","Down","Delete","App Menu Key","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","0","1","2","3","4","5","6","7","8","9"],function(t){t[t.stopped=1]="stopped",t[t.running=2]="running",t[t.paused=3]="paused"}(State||(State={})),ZICA.State=State,CanvasRenderingContext2D.prototype.mlFunction=mlFunction,CanvasRenderingContext2D.prototype.mlFillText=function(t,e,i,n,o,a,s,r){return this.mlFunction(t,e,i,n,o,s,a,r,"fillText")},CanvasRenderingContext2D.prototype.mlStrokeText=function(t,e,i,n,o,a,s,r){return this.mlFunction(t,e,i,n,o,s,a,r,"strokeText")},CanvasRenderingContext2D.prototype.mlFillStrokeText=function(t,e,i,n,o,a,s,r){return this.mlFunction(t,e,i,n,o,s,a,r,"fillStrokeText")};var touchToMouse=function(t){if(!(t.touches.length>1)){var e=t.changedTouches[0],i="";switch(t.type){case"touchstart":i="mousedown";break;case"touchmove":i="mousemove";break;case"touchend":i="mouseup";break;default:return}var n=document.createEvent("MouseEvent");n.initMouseEvent(i,!0,!0,window,1,e.screenX,e.screenY,e.clientX,e.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(n)}};ZICA.Vect2d=function(t,e){null==t?(this.X=0,this.Y=0):(this.X=t,this.Y=e)},ZICA.Vect2d.prototype.X=0,ZICA.Vect2d.prototype.Y=0,ZICA.Vect2d.prototype.set=function(t,e){this.X=t,this.Y=e},ZICA.Vect2d.prototype.clone=function(){return new ZICA.Vect2d(this.X,this.Y)},ZICA.Vect2d.prototype.add=function(t){return new ZICA.Vect2d(this.X+t.X,this.Y+t.Y)},ZICA.Vect2d.prototype.multiplyWithVect=function(t){return new ZICA.Vect2d(this.X*t.X,this.Y*t.Y)},ZICA.Vect2d.prototype.multiplyWithScal=function(t){return new ZICA.Vect2d(this.X*t,this.Y*t)},ZICA.Vect2d.prototype.multiplyThisWithScal=function(t){this.X*=t,this.Y*=t},ZICA.Vect2d.prototype.getLength=function(){return Math.sqrt(this.X*this.X+this.Y*this.Y)},ZICA.Vect2d.prototype.setLength=function(t){var e=this.X*this.X+this.Y*this.Y;e>-1e-7&&e<1e-7||(e=t/Math.sqrt(e),this.X*=e,this.Y*=e)},ZICA.Vect2d.prototype.substract=function(t){return new ZICA.Vect2d(this.X-t.X,this.Y-t.Y)},ZICA.Vect2d.prototype.normalize=function(){var t=this.X*this.X+this.Y*this.Y;t>-1e-7&&t<1e-7||(t=1/Math.sqrt(t),this.X*=t,this.Y*=t)},ZICA.Vect2d.prototype.addToThis=function(t){this.X+=t.X,this.Y+=t.Y},ZICA.Vect2d.prototype.equals=function(t){return this.X==t.X&&this.Y==t.Y},ZICA.Vect2d.prototype.equalsZero=function(){return 0==this.X&&0==this.Y},ZICA.Vect2d.prototype.getDistanceTo=function(t){var e=t.X-this.X,i=t.Y-this.Y;return Math.sqrt(e*e+i*i)},ZICA.Animator=function(){this.Type=-1},ZICA.Animator.prototype.getType=function(){return""},ZICA.Animator.prototype.animateNode=function(t,e){return!1},ZICA.Animator.prototype.onMouseDown=function(t){},ZICA.Animator.prototype.onClick=function(t){},ZICA.Animator.prototype.onMouseWheel=function(t){},ZICA.Animator.prototype.onMouseUp=function(t){},ZICA.Animator.prototype.onMouseMove=function(t){},ZICA.Animator.prototype.onMouseOut=function(t){},ZICA.Animator.prototype.onMouseOver=function(t){},ZICA.Animator.prototype.onKeyDown=function(t){return!1},ZICA.Animator.prototype.onKeyUp=function(t){return!1},ZICA.Animator.prototype.onKeyPress=function(t){return!1},ZICA.Animator.prototype.onCollision=function(t){},ZICA.Animator.prototype.reset=function(t){},ZICA.Animator.prototype.findActionByType=function(t){return null},ZICA.Animator.prototype.createClone=function(){return null},ZICA.AnimatorFlyCircle=function(t){this.Center=t.Center,this.Direction=t.Direction,this.VecU=new ZICA.Vect2d,this.VecV=new ZICA.Vect2d,this.StartTime=Date.now(),this.Speed=t.Speed,this.Radius=t.Radius},ZICA.AnimatorFlyCircle.prototype=new ZICA.Animator,ZICA.AnimatorFlyCircle.prototype.getType=function(){return"flycircle"},ZICA.AnimatorFlyCircle.prototype.createClone=function(){var t=new ZICA.AnimatorFlyCircle({});return t.Center=this.Center.clone(),t.Direction=this.Direction,t.VecU=this.VecU.clone(),t.VecV=this.VecV.clone(),t.Speed=this.Speed,t.Radius=this.Radius,t},ZICA.AnimatorFlyCircle.prototype.animateNode=function(t,e){var i=Date.now()-this.StartTime;if(0!=i){var n=i*this.Speed,o=this.Radius*Math.cos(n*(Math.PI/180)),a=this.Radius*Math.sin(n*(Math.PI/180)),s=o+this.Center.X,r=a+this.Center.Y;return t.x=s,t.y=r,!0}return!1},ZICA.Animator2DJumpNRun=function(t){this.ForwardKeyDown=!1,this.BackKeyDown=!1,this.PressedJump=!1,this.LastTime=null,this.JumpForce=0,this.JumpLengthMs=1e3,this.StandAnimation="",this.WalkLeftAnimation="",this.WalkRightAnimation="",this.Speed=t.Speed,this.JumpSpeed=t.JumpSpeed,this.JumpLengthMs=t.JumpLengthMs,this.PauseAfterJump=t.PauseAfterJump,this.StandAnimation=t.StandAnimation,this.WalkLeftAnimation=t.WalkLeftAnimation,this.WalkRightAnimation=t.WalkRightAnimation},ZICA.Animator2DJumpNRun.prototype=new ZICA.Animator,ZICA.Animator2DJumpNRun.prototype.getType=function(){return"2djumpnrun"},ZICA.Animator2DJumpNRun.prototype.createClone=function(){var t=new ZICA.Animator2DJumpNRun({});return t.Speed=this.Speed,t.JumpSpeed=this.JumpSpeed,t.JumpLengthMs=this.JumpLengthMs,t.PauseAfterJump=this.PauseAfterJump,t.StandAnimation=this.StandAnimation,t.WalkLeftAnimation=this.WalkLeftAnimation,t.WalkRightAnimation=this.WalkRightAnimation,t},ZICA.Animator2DJumpNRun.prototype.animateNode=function(t,e){e=Date.now();var i=!1;if(null==this.LastTime)return this.LastTime=e,this.InitPos=new ZICA.Vect2d(t.x,t.y),this.InitRotation=t.angle,!1;this.LastNodeUsed=t;var n=e-this.LastTime;this.LastTime=e,n>200&&(n=200);var o=new ZICA.Vect2d(t.x,t.y);this.ForwardKeyDown?(o.X+=this.Speed*n,t.animation=this.WalkRightAnimation):this.BackKeyDown?(o.X-=this.Speed*n,t.animation=this.WalkLeftAnimation):t.animation=this.StandAnimation;var a=t.getAnimatorOfType("collisionresponse");a&&(i=a.isFalling());var s=!0;return this.PauseAfterJump&&i&&(s=!1),this.PressedJump&&0==this.JumpForce&&s&&(this.PressedJump=!1,this.JumpForce=this.JumpLengthMs),this.JumpForce>0&&(o.Y-=this.JumpSpeed*n,this.JumpForce-=n,this.JumpForce<0&&(this.JumpForce=0)),t.x=o.X,t.y=o.Y,!0},ZICA.Animator2DJumpNRun.prototype.onKeyDown=function(t){return this.onKeyEvent(t.keyCode,!0)},ZICA.Animator2DJumpNRun.prototype.onKeyUp=function(t){return this.onKeyEvent(t.keyCode,!1)},ZICA.Animator2DJumpNRun.prototype.onKeyEvent=function(t,e){37==t||40==t?this.BackKeyDown=e:39!=t&&38!=t||(this.ForwardKeyDown=e),32==t&&e&&(this.PressedJump=!0)},ZICA.Animator2DJumpNRun.prototype.onMouseEvent=function(t,e){},ZICA.AnimatorTopDownMovement=function(t){this.UpKeyDown=!1,this.DownKeyDown=!1,this.LeftKeyDown=!1,this.RightKeyDown=!1,this.LastTime=null,this.StandAnimation="",this.WalkLeftAnimation="",this.WalkRightAnimation="",this.WalkUpAnimation="",this.WalkDownAnimation="",this.Speed=t.Speed,this.StandAnimation=t.StandAnimation,this.WalkLeftAnimation=t.WalkLeftAnimation,this.WalkRightAnimation=t.WalkRightAnimation,this.WalkUpAnimation=t.WalkUpAnimation,this.WalkDownAnimation=t.WalkDownAnimation},ZICA.AnimatorTopDownMovement.prototype=new ZICA.Animator,ZICA.AnimatorTopDownMovement.prototype.getType=function(){return"topdownmovement"},ZICA.AnimatorTopDownMovement.prototype.createClone=function(){var t=new ZICA.AnimatorTopDownMovement({});return t.Speed=this.Speed,t.StandAnimation=this.StandAnimation,t.WalkLeftAnimation=this.WalkLeftAnimation,t.WalkRightAnimation=this.WalkRightAnimation,t.WalkUpAnimation=this.WalkUpAnimation,t.WalkDownAnimation=this.WalkDownAnimation,t},ZICA.AnimatorTopDownMovement.prototype.animateNode=function(t,e){e=Date.now();if(null==this.LastTime)return this.LastTime=e,this.InitPos=new ZICA.Vect2d(t.x,t.y),!1;this.LastNodeUsed=t;var i=e-this.LastTime;this.LastTime=e,i>200&&(i=200);var n=new ZICA.Vect2d(t.x,t.y);return this.RightKeyDown||this.LeftKeyDown||this.UpKeyDown||this.DownKeyDown?(this.RightKeyDown&&(n.X+=this.Speed*i,t.animation=this.WalkRightAnimation),this.LeftKeyDown&&(n.X-=this.Speed*i,t.animation=this.WalkLeftAnimation),this.DownKeyDown&&(n.Y+=this.Speed*i,t.animation=this.WalkDownAnimation),this.UpKeyDown&&(n.Y-=this.Speed*i,t.animation=this.WalkUpAnimation)):t.animation=this.StandAnimation,t.x=n.X,t.y=n.Y,!0},ZICA.AnimatorTopDownMovement.prototype.onKeyDown=function(t){return this.onKeyEvent(t.keyCode,!0)},ZICA.AnimatorTopDownMovement.prototype.onKeyUp=function(t){return this.onKeyEvent(t.keyCode,!1)},ZICA.AnimatorTopDownMovement.prototype.onKeyEvent=function(t,e){37!=t&&65!=t||(this.LeftKeyDown=e),38!=t&&87!=t||(this.UpKeyDown=e),39!=t&&68!=t||(this.RightKeyDown=e),40!=t&&83!=t||(this.DownKeyDown=e),37!=t&&40!=t||(this.BackKeyDown=e)},ZICA.AnimatorKeyboardControlled=function(t){this.lastAnimTime=0,this.MoveSpeed=0,this.RunSpeed=0,this.RotateSpeed=0,this.JumpSpeed=0,this.PauseAfterJump=!1,this.UseAcceleration=!1,this.AccelerationSpeed=0,this.DecelerationSpeed=0,this.FollowSmoothingSpeed=15,this.AdditionalRotationForLooking=0,this.StandAnimation="",this.WalkAnimation="",this.JumpAnimation="",this.RunAnimation="",this.LastAnimationTime=Date.now(),this.LastJumpTime=this.LastAnimationTime,this.WasMovingLastFrame=!1,this.ShiftIsDown=!1,this.Registered=!1,this.leftKeyDown=!1,this.rightKeyDown=!1,this.upKeyDown=!1,this.downKeyDown=!1,this.jumpKeyDown=!1,this.AcceleratedSpeed=0,this.AccelerationIsForward=!1,this.firstUpdate=!0,this.DisableWithoutActiveCamera=!1,this.MoveSpeed=t.MoveSpeed,this.RunSpeed=t.RunSpeed,this.RotateSpeed=t.RotateSpeed,this.JumpSpeed=t.JumpSpeed,this.UseAcceleration=t.UseAcceleration,this.AccelerationSpeed=t.AccelerationSpeed,this.DecelerationSpeed=t.DecelerationSpeed,this.PauseAfterJump=t.PauseAfterJump,this.StandAnimation=t.StandAnimation,this.WalkAnimation=t.WalkAnimation,this.JumpAnimation=t.JumpAnimation,this.RunAnimation=t.RunAnimation,this.AdditionalRotationForLooking=t.AdditionalRotationForLooking},ZICA.AnimatorKeyboardControlled.prototype=new ZICA.Animator,ZICA.AnimatorKeyboardControlled.prototype.getType=function(){return"keyboardcontrolled"},ZICA.AnimatorKeyboardControlled.prototype.createClone=function(){var t=new ZICA.AnimatorKeyboardControlled({});return t.MoveSpeed=this.MoveSpeed,t.RunSpeed=this.RunSpeed,t.RotateSpeed=this.RotateSpeed,t.JumpSpeed=this.JumpSpeed,t.FollowSmoothingSpeed=this.FollowSmoothingSpeed,t.AdditionalRotationForLooking=this.AdditionalRotationForLooking,t.StandAnimation=this.StandAnimation,t.WalkAnimation=this.WalkAnimation,t.JumpAnimation=this.JumpAnimation,t.RunAnimation=this.RunAnimation,t.UseAcceleration=this.UseAcceleration,t.AccelerationSpeed=this.AccelerationSpeed,t.DecelerationSpeed=this.DecelerationSpeed,t.DisableWithoutActiveCamera=this.DisableWithoutActiveCamera,t},ZICA.AnimatorKeyboardControlled.prototype.setKeyBool=function(t,e){return 37==e||65==e?(this.leftKeyDown=t,t&&(this.rightKeyDown=!1),!0):39==e||68==e?(this.rightKeyDown=t,t&&(this.leftKeyDown=!1),!0):38==e||87==e?(this.upKeyDown=t,t&&(this.downKeyDown=!1),!0):40==e||83==e?(this.downKeyDown=t,t&&(this.upKeyDown=!1),!0):32==e&&(this.jumpKeyDown=t,!0)},ZICA.AnimatorKeyboardControlled.prototype.onKeyDown=function(t){return this.ShiftIsDown=1==t.shiftKey,this.setKeyBool(!0,t.keyCode)},ZICA.AnimatorKeyboardControlled.prototype.onKeyUp=function(t){return this.ShiftIsDown=1==t.shiftKey,this.setKeyBool(!1,t.keyCode)},ZICA.AnimatorKeyboardControlled.prototype.animateNode=function(t,e){var i=(e=Date.now())-this.lastAnimTime;i>250&&(i=250),this.lastAnimTime=e;var n=!1;if(this.LastAnimationTime=e,this.DisableWithoutActiveCamera){var o=t.scene.getActiveCamera();if(null!=o){var a=o.getAnimatorOfType("3rdpersoncamera");if(null==a)return!1;if(a.NodeToFollow!==t)return!1}}this.leftKeyDown&&(t.angle-=i*this.RotateSpeed*.001,n=!0),this.rightKeyDown&&(t.angle+=i*this.RotateSpeed*.001,n=!0);var s=Math.cos((t.angle+this.AdditionalRotationForLooking)*Math.PI/180),r=Math.sin((t.angle+this.AdditionalRotationForLooking)*Math.PI/180),h=new ZICA.Vect2d(s,r),c=this.ShiftIsDown,l=(c?this.RunSpeed:this.MoveSpeed)*i,d=0,u=this.downKeyDown,m=this.upKeyDown;if(this.UseAcceleration&&i&&(m||u?(this.AccelerationIsForward!=m&&(0==this.DecelerationSpeed?this.AcceleratedSpeed*=-1:this.AcceleratedSpeed=0),this.AccelerationIsForward=!u,d=l/i,this.AcceleratedSpeed+=this.AccelerationSpeed*d*(i/1e3),this.AcceleratedSpeed>d&&(this.AcceleratedSpeed=d),l=this.AcceleratedSpeed*i):0==this.DecelerationSpeed?this.AcceleratedSpeed=0:(d=l/Number(i),this.AcceleratedSpeed-=this.DecelerationSpeed*d*(i/1e3),this.AcceleratedSpeed<0&&(this.AcceleratedSpeed=0),l=this.AcceleratedSpeed*i)),h.setLength(l),m||u||this.UseAcceleration&&0!=this.AcceleratedSpeed){var p=h.clone();!u&&(m||u||this.AccelerationIsForward)||p.multiplyThisWithScal(-1);var A=new ZICA.Vect2d(t.x,t.y);A.addToThis(p),t.x=A.X,t.y=A.Y,n=!0,this.WasMovingLastFrame=!0}if(m||u)this.setAnimation(t,c?3:1,u),this.WasMovingLastFrame=!0,n=!0;else{var y=!1,C=t.getAnimatorOfType("collisionresponse");C&&(y=C.isFalling()),!y&&(this.hasAnimationType(t,1)||this.hasAnimationType(t,3)||this.hasAnimationType(t,2))&&this.setAnimation(t,0,!1)}if(this.jumpKeyDown){var g=t.getAnimatorOfType("collisionresponse");if(g&&!g.isFalling()){var f=0;0!=Game.scene.gravity&&(f=Math.floor(this.JumpSpeed*(1/Game.scene.gravity)*2e3)),(!this.PauseAfterJump||this.PauseAfterJump&&e-this.LastJumpTime>f)&&(g.jump(this.JumpSpeed),this.setAnimation(t,2,!1),this.LastJumpTime=e,n=!0)}}return n},ZICA.AnimatorKeyboardControlled.prototype.getAnimationNameFromType=function(t){switch(t){case 0:return this.StandAnimation;case 1:return this.WalkAnimation;case 2:return this.JumpAnimation;case 3:return this.RunAnimation}return""},ZICA.AnimatorKeyboardControlled.prototype.hasAnimationType=function(t,e){return this.setAnimation(t,e,!1,!0)},ZICA.AnimatorKeyboardControlled.prototype.setAnimation=function(t,e,i,n){return n?(t.animation,this.getAnimationNameFromType(e),!0):(t.animation=this.getAnimationNameFromType(e),!0)},ZICA.AnimatorGameAI=function(t){this.AIType=0,this.MovementSpeed=0,this.ActivationRadius=0,this.CanFly=!1,this.Health=100,this.PatrolWaitTimeMs=3e3,this.PathIdToFollow=-1,this.Tags="",this.AttacksAIWithTags="",this.PatrolRadius=100,this.RotationSpeedMs=0,this.AdditionalRotationForLooking=-90,this.RotationForLooking=!1,this.StandAnimation="",this.WalkAnimation="",this.DieAnimation="",this.AttackAnimation="",this.ActionHandlerOnAttack=null,this.ActionHandlerOnActivate=null,this.ActionHandlerOnHit=null,this.ActionHandlerOnDie=null,this.CurrentCommand=0,this.NextAttackTargetScanTime=0,this.LastPatrolStartTime=0,this.CurrentCommandTargetPos=null,this.CurrentCommandStartTime=0,this.CurrentCommandTicksDone=0,this.CurrentCommandExpectedTickCount=0,this.BeginPositionWhenStartingCurrentCommand=0,this.HandleCurrentCommandTargetNode=null,this.AttackCommandExecuted=!1,this.Activated=!1,this.CurrentlyShooting=!1,this.CurrentlyShootingLine=new Object,this.NextPathPointToGoTo=0,this.TheObject=null,this.LastTime=0,this.StartPositionOfActor=new ZICA.Vect2d,this.NearestSceneNodeFromAIAnimator_NodeOut=null,this.NearestSceneNodeFromAIAnimator_maxDistance=0,this.AIType=["This is the Player","Stand Still","Randomly Patrol"].indexOf(t.Mode),this.PatrolRadius=t.PatrolRadius,this.PatrolWaitTimeMs=t.PatrolWaitTimeMs,this.PathIdToFollow=t.PathIdToFollow,this.Health=t.Health,this.MovementSpeed=t.MovementSpeed,this.Tags=t.Tags,this.AttacksAIWithTags=t.AttacksActorsWithTags,this.CanFly=t.CanFly,this.ActivationRadius=t.ActivationRadius,this.StandAnimation=t.StandAnimation,this.WalkAnimation=t.WalkAnimation,this.DieAnimation=t.DieAnimation,this.AttackAnimation=t.AttackAnimation,this.ActionHandlerOnAttack=t.ActionOnAttack,this.ActionHandlerOnActivate=t.ActionOnActivate,this.ActionHandlerOnHit=t.ActionOnHit,this.ActionHandlerOnDie=t.ActionOnDie,this.AdditionalRotationForLooking=t.AdditionalRotationForLooking,this.RotationForLooking=t.RotationForLooking},ZICA.AnimatorGameAI.prototype=new ZICA.Animator,ZICA.AnimatorGameAI.prototype.getType=function(){return"gameai"},ZICA.AnimatorGameAI.prototype.createClone=function(){var t=new ZICA.AnimatorGameAI({});return t.AIType=this.AIType,t.MovementSpeed=this.MovementSpeed,t.ActivationRadius=this.ActivationRadius,t.CanFly=this.CanFly,t.Health=this.Health,t.Tags=this.Tags,t.AttacksAIWithTags=this.AttacksAIWithTags,t.PatrolRadius=this.PatrolRadius,t.RotationSpeedMs=this.RotationSpeedMs,t.PathIdToFollow=this.PathIdToFollow,t.PatrolWaitTimeMs=this.PatrolWaitTimeMs,t.AdditionalRotationForLooking=this.AdditionalRotationForLooking,t.RotationForLooking=this.RotationForLooking,t.StandAnimation=this.StandAnimation,t.WalkAnimation=this.WalkAnimation,t.DieAnimation=this.DieAnimation,t.AttackAnimation=this.AttackAnimation,t.ActionHandlerOnAttack=this.ActionHandlerOnAttack?this.ActionHandlerOnAttack.createClone():null,t.ActionHandlerOnActivate=this.ActionHandlerOnActivate?this.ActionHandlerOnActivate.createClone():null,t.ActionHandlerOnHit=this.ActionHandlerOnHit?this.ActionHandlerOnHit.createClone():null,t.ActionHandlerOnDie=this.ActionHandlerOnDie?this.ActionHandlerOnDie.createClone():null,t},ZICA.AnimatorGameAI.prototype.animateNode=function(t,e){e=Date.now();if(null==t)return!1;var i=e-this.LastTime;i>150&&(i=150),this.LastTime=e;var n=0,o=!1;this.TheObject!==t&&(this.TheObject=t,this.StartPositionOfActor=new ZICA.Vect2d(t.x,t.y));var a=new ZICA.Vect2d(t.x,t.y);if(3==this.CurrentCommand);else if(1==this.CurrentCommand)if(n=this.getCharacterWidth(t),this.CurrentCommandTargetPos.substract(a).getLength()<n)this.CurrentCommand=0,this.setAnimation(t,0),o=!0;else{var s=!1;if(this.CurrentCommandTicksDone>2){var r=this.CurrentCommandTicksDone*(this.MovementSpeed/1e3);1.2*this.BeginPositionWhenStartingCurrentCommand.substract(a).getLength()<r&&(this.CurrentCommand=0,this.setAnimation(t,0),s=!0)}if(!s){this.CurrentCommandTicksDone+=i;var h=this.CurrentCommandTargetPos.substract(a);h.setLength(this.MovementSpeed/1e3*i),this.CanFly||(h.Y=0),t.x+=h.X,t.y+=h.Y}o=this.animateRotation(t,e-this.CurrentCommandStartTime,this.CurrentCommandTargetPos.substract(a),this.RotationSpeedMs)}else if(2==this.CurrentCommand)this.CurrentCommandTicksDone+=i,!this.AttackCommandExecuted&&this.CurrentCommandTicksDone>this.CurrentCommandExpectedTickCount/2&&(this.CurrentlyShooting=!0,this.ActionHandlerOnAttack&&this.ActionHandlerOnAttack.execute(t),this.CurrentlyShooting=!1,this.AttackCommandExecuted=!0,o=!0),this.CurrentCommandTicksDone>this.CurrentCommandExpectedTickCount?this.CurrentCommand=0:o=this.animateRotation(t,e-this.CurrentCommandStartTime,this.CurrentCommandTargetPos.substract(a),Math.min(this.RotationSpeedMs,this.CurrentCommandExpectedTickCount));else if(0==this.CurrentCommand&&(1==this.AIType||2==this.AIType||3==this.AIType)){var c=this.scanForAttackTargetIfNeeded(e,a);if(null!=c){var l=this.getAttackDistanceFromWeapon();!this.Activated&&this.ActionHandlerOnActivate&&this.ActionHandlerOnActivate.execute(t),this.Activated=!0,o=!0,new ZICA.Vect2d(c.x,c.y).getDistanceTo(a)<l&&this.isNodeVisibleFromNode(c,t)?(this.CurrentlyShootingLine.Start=new ZICA.Vect2d(t.getCenter().x,t.getCenter().y),this.CurrentlyShootingLine.End=new ZICA.Vect2d(c.getCenter().x,c.getCenter().y),this.attackTarget(t,c,new ZICA.Vect2d(c.x,c.y),a,e)):this.moveToTarget(t,new ZICA.Vect2d(c.x,c.y),a,e)}else if((2==this.AIType||3==this.AIType)&&(!this.LastPatrolStartTime||e>this.LastPatrolStartTime+this.PatrolWaitTimeMs)){n=this.getCharacterWidth(t);var d=null;if(3==this.AIType);else{var u=this.PatrolRadius;this.LastPatrolStartTime=e,(d=new ZICA.Vect2d((Math.random()-.5)*u,(Math.random()-.5)*u)).addToThis(this.StartPositionOfActor),this.CanFly||(d.Y=this.StartPositionOfActor.Y)}d.substract(a).getLength()<n||(this.moveToTarget(t,d,a,e),o=!0)}}return o},ZICA.AnimatorGameAI.prototype.animateRotation=function(t,e,i,n){return!!this.RotationForLooking&&("entity"==t.type&&(t.angle=180*Math.atan2(i.X,-i.Y)/Math.PI,t.angle+=this.AdditionalRotationForLooking),!1)},ZICA.AnimatorGameAI.prototype.moveToTarget=function(t,e,i,n){this.CurrentCommand=1,this.CurrentCommandTargetPos=e,this.CurrentCommandStartTime=n,this.BeginPositionWhenStartingCurrentCommand=i,this.CurrentCommandTicksDone=0,this.CurrentCommandExpectedTickCount=0,this.setAnimation(t,1)},ZICA.AnimatorGameAI.prototype.attackTarget=function(t,e,i,n,o){this.CurrentCommand=2,this.CurrentCommandTargetPos=i,this.CurrentCommandStartTime=o,this.HandleCurrentCommandTargetNode=e,this.BeginPositionWhenStartingCurrentCommand=n,this.CurrentCommandTicksDone=0,this.CurrentCommandExpectedTickCount=500,this.AttackCommandExecuted=!1;var a=this.setAnimation(t,2);0!=a&&(this.CurrentCommandExpectedTickCount=a)},ZICA.AnimatorGameAI.prototype.aiCommandCancel=function(t){this.CurrentCommand=0,this.setAnimation(t,0)},ZICA.AnimatorGameAI.prototype.die=function(t,e,i){this.CurrentCommand=3,this.CurrentCommandStartTime=i,this.BeginPositionWhenStartingCurrentCommand=e,this.CurrentCommandTicksDone=0,this.CurrentCommandExpectedTickCount=500;this.setAnimation(t,3)},ZICA.AnimatorGameAI.prototype.isNodeVisibleFromNode=function(t,e){if(!t||!e)return!1;var i=t.getCenter(),n=e.getCenter();if(this.TheObject==e&&"entity"==e.type&&e.DoesCollision){var o=.5*e.width,a=n.substract(i);a.normalize(),a.multiplyThisWithScal(o+.02*o),i.addToThis(a)}return this.isPositionVisibleFromPosition(i,n)},ZICA.AnimatorGameAI.prototype.isPositionVisibleFromPosition=function(t,e){return!0},ZICA.AnimatorGameAI.prototype.getNearestSceneNodeFromAIAnimatorAndDistance=function(t,e,i){if("scene"==t.type&&(t.visible=!0),t&&t.visible){var n=!1,o=e.getDistanceTo(new ZICA.Vect2d(t.x,t.y));if(o<this.NearestSceneNodeFromAIAnimator_maxDistance&&"scene"!=t.type){var a=t.getAnimatorOfType("gameai");a&&""!=i&&a!==this&&a.isAlive()&&(n=-1!=a.Tags.indexOf(i))}if(n&&(this.NearestSceneNodeFromAIAnimator_maxDistance=o,this.NearestSceneNodeFromAIAnimator_NodeOut=t),t.children)for(var s=0;s<t.children.length;++s){var r=t.children[s];this.getNearestSceneNodeFromAIAnimatorAndDistance(r,e,i)}}},ZICA.AnimatorGameAI.prototype.scanForAttackTargetIfNeeded=function(t,e){return this.ActivationRadius<=0||!this.TheObject||0==this.AttacksAIWithTags.length?null:!this.NextAttackTargetScanTime||t>this.NextAttackTargetScanTime?(this.NearestSceneNodeFromAIAnimator_maxDistance=this.ActivationRadius,this.NearestSceneNodeFromAIAnimator_NodeOut=null,this.getNearestSceneNodeFromAIAnimatorAndDistance(Game.scene,e,this.AttacksAIWithTags),this.NextAttackTargetScanTime=t+500+1e3*Math.random(),this.NearestSceneNodeFromAIAnimator_NodeOut):null},ZICA.AnimatorGameAI.prototype.getAttackDistanceFromWeapon=function(){var t=1e3;if(this.ActionHandlerOnAttack){var e=this.ActionHandlerOnAttack.findAction("Shoot");e&&(t=e.WeaponRange)}return t},ZICA.AnimatorGameAI.prototype.getCharacterWidth=function(t){return null!=t?10:t.width},ZICA.AnimatorGameAI.prototype.getAnimationNameFromType=function(t){switch(t){case 0:return this.StandAnimation;case 1:return this.WalkAnimation;case 2:return this.AttackAnimation;case 3:return this.DieAnimation}return""},ZICA.AnimatorGameAI.prototype.setAnimation=function(t,e){return t.animations&&(t.animation=this.getAnimationNameFromType(e)),!0},ZICA.AnimatorGameAI.prototype.isCurrentlyShooting=function(){return this.CurrentlyShooting},ZICA.AnimatorGameAI.prototype.getCurrentlyShootingLine=function(){return this.CurrentlyShootingLine},ZICA.AnimatorGameAI.prototype.isAlive=function(){return this.Health>0},ZICA.AnimatorGameAI.prototype.OnHit=function(t,e){e&&0!=this.Health&&(this.Health-=t,this.Health<0&&(this.Health=0),0==this.Health?(null!=this.ActionHandlerOnDie&&this.ActionHandlerOnDie.execute(e),this.die(e,new ZICA.Vect2d(e.x,e.y),0)):null!=this.ActionHandlerOnHit&&this.ActionHandlerOnHit.execute(e))},ZICA.AnimatorGameAI.prototype.findActionByType=function(t){var e=null;return this.ActionHandlerOnAttack&&(e=this.ActionHandlerOnAttack.findAction(t))?e:this.ActionHandlerOnActivate&&(e=this.ActionHandlerOnActivate.findAction(t))?e:this.ActionHandlerOnHit&&(e=this.ActionHandlerOnHit.findAction(t))?e:this.ActionHandlerOnDie&&(e=this.ActionHandlerOnDie.findAction(t))?e:null},ZICA.AnimatorRotation=function(t){this.Rotation=t.Speed,this.StartTime=Date.now(),this.RotateToTargetAndStop=!1,this.RotateToTargetEndTime=0,this.BeginRotation=null},ZICA.AnimatorRotation.prototype=new ZICA.Animator,ZICA.AnimatorRotation.prototype.getType=function(){return"rotation"},ZICA.AnimatorRotation.prototype.createClone=function(){var t=new ZICA.AnimatorRotation({});return t.Rotation=this.Rotation,t.StartTime=this.StartTime,t},ZICA.AnimatorRotation.prototype.animateNode=function(t,e){var i=(e=Date.now())-this.StartTime;if(this.RotateToTargetAndStop){if(this.RotateToTargetEndTime-this.StartTime==0)return!1;var n=(e-this.StartTime)/(this.RotateToTargetEndTime-this.StartTime);if(!(n>1))return t.angle=this.BeginRotation+(this.Rotation-this.BeginRotation)*n,!0;t.angle=this.Rotation,t.removeAnimator(this)}else if(0!=i)return t.angle+=this.Rotation*(i/10),this.StartTime=e,!0;return!1},ZICA.AnimatorRotation.prototype.setRotateToTargetAndStop=function(t,e,i){this.RotateToTargetAndStop=!0,this.Rotation=t,this.BeginRotation=e,this.RotateToTargetEndTime=this.StartTime+i},ZICA.AnimatorFollowPath=function(t){this.TimeNeeded=5e3,this.LookIntoMovementDirection=!1,this.OnlyMoveWhenCameraActive=!0,this.TimeDisplacement=0,this.EndMode=0,this.StartTime=0,this.LastObject=null,this.PathToFollow=null,this.AdditionalRotation=null,this.LastPercentageDoneActionFired=0,this.bActionFired=!1,this.PathToFollow=t.PathToFollow,this.PathToFollow&&this.PathToFollow.length&&this.PathToFollow.forEach(function(t,e,i){var n=t.split(",");i[e]=new ZICA.Vect2d(Number(n[0]),Number(n[1]))}),this.TimeNeeded=t.TimeNeeded,this.LookIntoMovementDirection=t.LookIntoMovementDirection,this.AdditionalRotation=t.AdditionalRotation,this.TimeDisplacement=t.TimeDisplacement,this.EndMode="Start Again"==t.EndMode?0:1},ZICA.AnimatorFollowPath.prototype=new ZICA.Animator,ZICA.AnimatorFollowPath.EFPFEM_START_AGAIN=0,ZICA.AnimatorFollowPath.EFPFEM_STOP=1,ZICA.AnimatorFollowPath.EFPFEM_SWITCH_TO_CAMERA=2,ZICA.AnimatorFollowPath.prototype.getType=function(){return"followpath"},ZICA.AnimatorFollowPath.prototype.createClone=function(){var t=new ZICA.AnimatorFollowPath({});return t.TimeNeeded=this.TimeNeeded,t.LookIntoMovementDirection=this.LookIntoMovementDirection,t.OnlyMoveWhenCameraActive=this.OnlyMoveWhenCameraActive,t.PathToFollow=this.PathToFollow.slice(),t.TimeDisplacement=this.TimeDisplacement,t.AdditionalRotation=this.AdditionalRotation,t.EndMode=this.EndMode,t.CameraToSwitchTo=this.CameraToSwitchTo,t.TheActionHandler=this.TheActionHandler?this.TheActionHandler.createClone():null,t},ZICA.AnimatorFollowPath.prototype.setOptions=function(t,e,i){this.EndMode=t,this.LookIntoMovementDirection=i,this.TimeNeeded=e},ZICA.AnimatorFollowPath.prototype.animateNode=function(t,e){e=Date.now();if(null==t||!this.TimeNeeded)return!1;if(t!==this.LastObject)return this.setNode(t),!1;var i;this.StartTime||(this.StartTime=Date.now());var n=(e-this.StartTime+this.TimeDisplacement)/this.TimeNeeded;if(n>1)switch(this.EndMode){case ZICA.AnimatorFollowPath.EFPFEM_START_AGAIN:n%=1;break;case ZICA.AnimatorFollowPath.EFPFEM_STOP:n=1;break;case ZICA.AnimatorFollowPath.EFPFEM_SWITCH_TO_CAMERA:n=1,this.SwitchedToNextCamera||(this.switchToNextCamera(),this.SwitchedToNextCamera=!0);break;case 3:n>this.LastPercentageDoneActionFired+1&&null!=this.TheActionHandler&&(this.TheActionHandler.execute(t),this.LastPercentageDoneActionFired=n),n%=1;break;case 4:n=1,this.bActionFired||null==this.TheActionHandler||(this.TheActionHandler.execute(t),this.bActionFired=!0)}else this.SwitchedToNextCamera=!1;var o=n*(this.PathToFollow.length-1),a=Math.floor(o),s=Math.ceil(o),r=o-a,h=this.PathToFollow[a],c=this.PathToFollow[s].substract(h);c.multiplyThisWithScal(r);var l=h.add(c);return i=!l.equals(new ZICA.Vect2d(t.x,t.y)),t.x=l.X,t.y=l.Y,this.LookIntoMovementDirection&&this.PathToFollow.length&&(c.normalize(),"entity"==t.type&&(t.angle=180*Math.atan2(c.X,-c.Y)/Math.PI,t.angle+=this.AdditionalRotation)),i},ZICA.AnimatorFollowPath.prototype.setNode=function(t){this.LastObject=t},ZICA.AnimatorFollowPath.prototype.findActionByType=function(t){return this.TheActionHandler?this.TheActionHandler.findAction(t):null},ZICA.AnimatorFlyStraight=function(t){this.Start=new ZICA.Vect2d(0,0),this.End=new ZICA.Vect2d(40,40),this.StartTime=Date.now(),this.TimeForWay=3e3,this.Loop=!1,this.DeleteMeAfterEndReached=!1,this.AnimateCameraTargetInsteadOfPosition=!1,this.TestShootCollisionWithBullet=!1,this.ShootCollisionNodeToIgnore=null,this.ShootCollisionDamage=0,this.DeleteSceneNodeAfterEndReached=!1,this.ActionToExecuteOnEnd=!1,this.ExecuteActionOnEndOnlyIfTimeSmallerThen=0,t.Start&&(this.Start=t.Start.clone()),t.End&&(this.End=t.End.clone()),t.TimeForWay&&(this.TimeForWay=t.TimeForWay),t.Loop&&(this.Loop=t.Loop),this.recalculateImidiateValues(),t.deleteMeAfterEndReached&&(this.DeleteMeAfterEndReached=t.deleteMeAfterEndReached),t.animateCameraTargetInsteadOfPosition&&(this.AnimateCameraTargetInsteadOfPosition=t.animateCameraTargetInsteadOfPosition)},ZICA.AnimatorFlyStraight.prototype=new ZICA.Animator,ZICA.AnimatorFlyStraight.prototype.getType=function(){return"flystraight"},ZICA.AnimatorFlyStraight.prototype.createClone=function(){var t=new ZICA.AnimatorFlyStraight({});return t.Start=this.Start.clone(),t.End=this.End.clone(),t.Vector=this.Vector.clone(),t.WayLength=this.WayLength,t.TimeFactor=this.TimeFactor,t.TimeForWay=this.TimeForWay,t.Loop=this.Loop,t.AnimateCameraTargetInsteadOfPosition=this.AnimateCameraTargetInsteadOfPosition,t.DeleteSceneNodeAfterEndReached=this.DeleteSceneNodeAfterEndReached,t.ActionToExecuteOnEnd=this.ActionToExecuteOnEnd?this.ActionToExecuteOnEnd.createClone():null,t.ExecuteActionOnEndOnlyIfTimeSmallerThen=this.ExecuteActionOnEndOnlyIfTimeSmallerThen,t},ZICA.AnimatorFlyStraight.prototype.animateNode=function(t,e){var i=Date.now(),n=i-this.StartTime,o=!1;if(0!=n){var a=this.Start.clone();return!this.Loop&&n>=this.TimeForWay?(a=this.End.clone(),o=!0):a.addToThis(this.Vector.multiplyWithScal(n%this.TimeForWay*this.TimeFactor)),this.AnimateCameraTargetInsteadOfPosition||(t.x=a.X,t.y=a.Y),this.TestShootCollisionWithBullet&&this.StartTime!=i&&(o=this.doShootCollisionTest(t)||o),o&&this.DeleteMeAfterEndReached&&t.removeAnimator(this),!0}return!1},ZICA.AnimatorFlyStraight.prototype.doShootCollisionTest=function(t){if(!t)return!1;t.updateAbsolutePosition();for(var e=t.getTransformedBoundingBox(),i=!1,n=t.scene.getAllSceneNodesWithAnimator("gameai"),o=0;o<n.length;++o)if(n[o]!==this.ShootCollisionNodeToIgnore){var a=n[o].getAnimatorOfType("gameai");if((!a||a.isAlive())&&e.intersectsWithBox(n[o].getTransformedBoundingBox())){a.OnHit(this.ShootCollisionDamage,n[o]),i=!0;break}}return i},ZICA.AnimatorFlyStraight.prototype.recalculateImidiateValues=function(){this.Vector=this.End.substract(this.Start),this.WayLength=this.Vector.getLength(),this.Vector.normalize(),this.TimeFactor=this.WayLength/this.TimeForWay},ZICA.AnimatorCameraFollow=function(t){this.StartTime=Date.now()},ZICA.AnimatorCameraFollow.prototype=new ZICA.Animator,ZICA.AnimatorCameraFollow.prototype.getType=function(){return"camerafollow"},ZICA.AnimatorCameraFollow.prototype.createClone=function(){return new ZICA.AnimatorCameraFollow({})},ZICA.AnimatorCameraFollow.prototype.animateNode=function(t,e){Date.now(),this.StartTime;Game.scene.x=t.x+t.width/2,Game.scene.y=t.y+t.height/2},ZICA.AnimatorOnClick=function(t){this.Registered=!1,this.Occluded=t.NoClickWhenOccluded,this.TheActionHandler=t.Action},ZICA.AnimatorOnClick.prototype=new ZICA.Animator,ZICA.AnimatorOnClick.prototype.getType=function(){return"onclick"},ZICA.AnimatorOnClick.prototype.createClone=function(){var t=new ZICA.AnimatorOnClick;return t.BoundingBoxTestOnly=this.BoundingBoxTestOnly,t.CollidesWithWorld=this.CollidesWithWorld,t.TheActionHandler=this.TheActionHandler?this.TheActionHandler.createClone():null,t},ZICA.AnimatorOnClick.prototype.animateNode=function(t,e){var i=this.Registered;return this.Registered=!1,i},ZICA.AnimatorOnClick.prototype.onClick=function(t,e){this.Registered=!0,this.checkOccluded(e,t)||this.TheActionHandler&&this.TheActionHandler.execute(e)},ZICA.AnimatorOnClick.prototype.checkOccluded=function(t,e){if(!this.Occluded)return!1;for(var i=t.isScene?0:Game.entityList.indexOf(t)+1,n=Game.entityList;i<n.length;i++){var o=n[i];if(Game.pointInBox(e,o)&&(o.priority>=t.priority||t.isScene))return!0}return!1},ZICA.AnimatorOnClick.prototype.invokeAction=function(t){this.TheActionHandler&&this.TheActionHandler.execute(t)},ZICA.AnimatorOnClick.prototype.findActionByType=function(t){return this.TheActionHandler?this.TheActionHandler.findAction(t):null},ZICA.AnimatorOnFirstFrame=function(t){this.TheActionHandler=t.Action},ZICA.AnimatorOnFirstFrame.prototype=new ZICA.Animator,ZICA.AnimatorOnFirstFrame.prototype.getType=function(){return"onfirstframe"},ZICA.AnimatorOnFirstFrame.prototype.createClone=function(){var t=new ZICA.AnimatorOnFirstFrame({});return t.TheActionHandler=this.TheActionHandler?this.TheActionHandler.createClone():null,t},ZICA.AnimatorOnFirstFrame.prototype.animateNode=function(t,e){Game.scene.firstFrame&&this.TheActionHandler&&this.TheActionHandler.execute(t)},ZICA.AnimatorOnEveryFrame=function(t){this.TheActionHandler=t.Action},ZICA.AnimatorOnEveryFrame.prototype=new ZICA.Animator,ZICA.AnimatorOnEveryFrame.prototype.getType=function(){return"oneveryframe"},ZICA.AnimatorOnEveryFrame.prototype.createClone=function(){var t=new ZICA.AnimatorOnEveryFrame({});return t.TheActionHandler=this.TheActionHandler?this.TheActionHandler.createClone():null,t},ZICA.AnimatorOnEveryFrame.prototype.animateNode=function(t,e){this.TheActionHandler&&this.TheActionHandler.execute(t)},ZICA.AnimatorOnMouse=function(t){this.Registered=!1,this.Occluded=t.NoClickWhenOccluded,this.type=t.MouseEvent,this.TheActionHandler=t.Action},ZICA.AnimatorOnMouse.prototype=new ZICA.Animator,ZICA.AnimatorOnMouse.prototype.getType=function(){return"onmouse"},ZICA.AnimatorOnMouse.prototype.createClone=function(){var t=new ZICA.AnimatorOnMouse({});return t.type=this.type,t.CollidesWithWorld=this.CollidesWithWorld,t.TheActionHandler=this.TheActionHandler?this.TheActionHandler.createClone():null,t},ZICA.AnimatorOnMouse.prototype.animateNode=function(t,e){var i=this.Registered;return this.Registered=!1,i},ZICA.AnimatorOnMouse.prototype.onClick=function(t,e){"Mouse Click"==this.type&&(this.Registered=!0,this.checkOccluded(e,t)||this.TheActionHandler&&this.TheActionHandler.execute(e))},ZICA.AnimatorOnMouse.prototype.onMouseDown=function(t,e){"Mouse Down"==this.type&&(this.Registered=!0,this.checkOccluded(e,t)||this.TheActionHandler&&this.TheActionHandler.execute(e))},ZICA.AnimatorOnMouse.prototype.onMouseUp=function(t,e){"Mouse Up"==this.type&&(this.Registered=!0,this.checkOccluded(e,t)||this.TheActionHandler&&this.TheActionHandler.execute(e))},ZICA.AnimatorOnMouse.prototype.onMouseOver=function(t,e){"Mouse Over"==this.type&&(this.Registered=!0,this.checkOccluded(e,t)||this.TheActionHandler&&this.TheActionHandler.execute(e))},ZICA.AnimatorOnMouse.prototype.onMouseOut=function(t,e){"Mouse Out"==this.type&&(this.Registered=!0,this.checkOccluded(e,t)||this.TheActionHandler&&this.TheActionHandler.execute(e))},ZICA.AnimatorOnMouse.prototype.checkOccluded=function(t,e){if(!this.Occluded)return!1;for(var i=t.isScene?0:Game.entityList.indexOf(t)+1,n=Game.entityList;i<n.length;i++){var o=n[i];if(Game.pointInBox(e,o)&&(o.priority>=t.priority||t.isScene))return!0}return!1},ZICA.AnimatorOnMouse.prototype.findActionByType=function(t){return this.TheActionHandler?this.TheActionHandler.findAction(t):null},ZICA.AnimatorOnKey=function(t){this.Registered=!1,this.Key=t.Key,this.KeyEvent=t.KeyEvent,this.TheActionHandler=t.Action},ZICA.AnimatorOnKey.prototype=new ZICA.Animator,ZICA.AnimatorOnKey.prototype.getType=function(){return"onkey"},ZICA.AnimatorOnKey.prototype.createClone=function(){var t=new ZICA.AnimatorOnKey({});return t.Key=this.Key,t.KeyEvent=this.KeyEvent,t.TheActionHandler=this.TheActionHandler?this.TheActionHandler.createClone():null,t},ZICA.AnimatorOnKey.prototype.animateNode=function(t,e){var i=this.Registered;return this.Registered=!1,i},ZICA.AnimatorOnKey.prototype.onKeyUp=function(t,e){this.Registered=!0,"Key Pressed Up"==this.KeyEvent&&Game.Keys[this.Key.toLowerCase()]==t.which&&this.TheActionHandler&&this.TheActionHandler.execute(e)},ZICA.AnimatorOnKey.prototype.onKeyDown=function(t,e){this.Registered=!0,"Key Pressed Down"==this.KeyEvent&&Game.Keys[this.Key.toLowerCase()]==t.which&&this.TheActionHandler&&this.TheActionHandler.execute(e)},ZICA.AnimatorOnKey.prototype.onKeyPress=function(t,e){this.Registered=!0,"Key Pressed"==this.KeyEvent&&Game.Keys[this.Key.toLowerCase()]==t.which&&this.TheActionHandler&&this.TheActionHandler.execute(e)},ZICA.AnimatorOnKey.prototype.findActionByType=function(t){return this.TheActionHandler?this.TheActionHandler.findAction(t):null},ZICA.AnimatorTimer=function(t){this.TimeLastTimed=0,this.TheActionHandler=t.Action,this.TickEverySeconds=t.IntervalMS,this.TimeLastTimed=Date.now()},ZICA.AnimatorTimer.prototype=new ZICA.Animator,ZICA.AnimatorTimer.prototype.getType=function(){return"timer"},ZICA.AnimatorTimer.prototype.createClone=function(){var t=new ZICA.AnimatorTimer({});return t.TheActionHandler=this.TheActionHandler?this.TheActionHandler.createClone():null,t.TimeLastTimed=this.TimeLastTimed,t.TickEverySeconds=this.TickEverySeconds,t},ZICA.AnimatorTimer.prototype.animateNode=function(t,e){e.timeElapsed;if(null==t)return!1;if(this.TickEverySeconds>0){var i=Date.now();if(i-this.TimeLastTimed>this.TickEverySeconds)return this.TimeLastTimed=i,this.TheActionHandler&&this.TheActionHandler.execute(t),!0}return!1},ZICA.AnimatorOnProximity=function(t){this.NodeInside=!1,this.NodesInside=[],this.TheActionHandler=t.Action,this.NearToNodes=t.NearToNodes,this.TriggeredWhen=t.TriggeredWhen},ZICA.AnimatorOnProximity.prototype=new ZICA.Animator,ZICA.AnimatorOnProximity.prototype.getType=function(){return"onproximity"},ZICA.AnimatorOnProximity.prototype.createClone=function(){var t=new ZICA.AnimatorOnProximity({});return t.TheActionHandler=this.TheActionHandler?this.TheActionHandler.createClone():null,t.NearToNodes=this.NearToNodes,t.TriggeredWhen=this.TriggeredWhen,t.NodeInside=this.NodeInside,t},ZICA.AnimatorOnProximity.prototype.animateNode=function(t,e){if("Leaves Radius"==this.TriggeredWhen&&this.NodeInside){for(var i=0,n=Game.entityList;i<n.length;i++){var o=n[i];if(o!=t&&ZICA.boxIntersection(t,o))return}this.TheActionHandler&&this.TheActionHandler.execute(t),this.NodeInside=!1}},ZICA.AnimatorOnProximity.prototype.onCollision=function(t,e){this.NodeInside=!0,"Enters Radius"==this.TriggeredWhen&&(null!=this.NearToNodes&&t.other.name!=this.NearToNodes||this.TheActionHandler&&this.TheActionHandler.execute(e))},ZICA.AnimatorOnProximity=function(t){this.NodeInside=!1,this.NodesInside=[],this.TheActionHandler=t.Action,this.NearToNodes=t.NearToNodes,this.TriggeredWhen=t.TriggeredWhen},ZICA.AnimatorOnProximity.prototype=new ZICA.Animator,ZICA.AnimatorOnProximity.prototype.getType=function(){return"onproximity"},ZICA.AnimatorOnProximity.prototype.createClone=function(){var t=new ZICA.AnimatorOnProximity({});return t.TheActionHandler=this.TheActionHandler?this.TheActionHandler.createClone():null,t.NearToNodes=this.NearToNodes,t.TriggeredWhen=this.TriggeredWhen,t.NodeInside=this.NodeInside,t},ZICA.AnimatorOnProximity.prototype.animateNode=function(t,e){if("Leaves Radius"==this.TriggeredWhen&&this.NodeInside){var i=Game.getEntityById(this.NearToNodes);if(!i)return;if(ZICA.boxIntersection(t,i))return;this.TheActionHandler&&this.TheActionHandler.execute(t),this.NodeInside=!1}},ZICA.AnimatorOnProximity.prototype.onCollision=function(t,e){this.NodeInside=!0,"Enters Radius"==this.TriggeredWhen&&t.other.__guid==this.NearToNodes&&this.TheActionHandler&&this.TheActionHandler.execute(e)},ZICA.AnimatorCollisionResponse=function(t){this.AffectedByGravity=t.AffectedByGravity,this.Node=null,this.LastAnimationTime=null,this.LastPosition=new ZICA.Vect2d(0,0),this.Falling=!1,this.FallStartTime=0,this.JumpForce=0,this.reset()},ZICA.AnimatorCollisionResponse.prototype=new ZICA.Animator,ZICA.AnimatorCollisionResponse.prototype.getType=function(){return"collisionresponse"},ZICA.AnimatorCollisionResponse.prototype.createClone=function(){var t=new ZICA.AnimatorCollisionResponse({});return t.AffectedByGravity=this.AffectedByGravity,t},ZICA.AnimatorCollisionResponse.prototype.reset=function(){this.Node=null,this.LastAnimationTime=Date.now()},ZICA.AnimatorCollisionResponse.prototype.isFalling=function(){return this.Falling},ZICA.AnimatorCollisionResponse.prototype.animateNode=function(t,e){var i=(e=Date.now())-this.LastAnimationTime;if(i>150&&(i=150),0==i)return!1;if(this.LastAnimationTime=e,this.Node!==t)return this.Node=t,this.LastPosition=new ZICA.Vect2d(t.x,t.y),!1;var n=Math.abs(this.LastPosition.Y-t.y)>.5;return this.JumpForce>0&&(t.y-=.001*this.JumpForce*i,this.JumpForce-=i,this.JumpForce<0&&(this.JumpForce=0)),this.AffectedByGravity?t.physicType="dynamic":t.physicType="kinematic",n?(this.Falling||(this.FallStartTime=e),this.Falling=!0):this.Falling=!1,this.LastPosition=new ZICA.Vect2d(t.x,t.y),!1},ZICA.AnimatorCollisionResponse.prototype.jump=function(t){0==this.JumpForce&&(this.JumpForce=100*t)},ZICA.AnimatorCollisionResponse.prototype.onCollision=function(t,e){Game.resolveElastic(e,t.other)},ZICA.AnimatorCollide=function(t){},ZICA.AnimatorCollide.prototype=new ZICA.Animator,ZICA.AnimatorCollide.prototype.getType=function(){return"collide"},ZICA.AnimatorCollide.prototype.createClone=function(){return new ZICA.AnimatorCollide({})},ZICA.AnimatorCollide.prototype.animateNode=function(t,e){},ZICA.AnimatorCollide.prototype.onCollision=function(t,e){e.x=e.prevX,e.y=e.prevY},ZICA.AnimatorPhysicsEngine=function(t){this.shape=t.Shape,this.mass=t.Mass,this.position=t.Position,this.size=t.Size,this.autoSize=t.autoSize,this.radius=t.Radius,this.length=t.length},ZICA.AnimatorPhysicsEngine.prototype=new ZICA.Animator,ZICA.AnimatorPhysicsEngine.prototype.getType=function(){return"physicsengine"},ZICA.AnimatorPhysicsEngine.prototype.createClone=function(){var t=new ZICA.AnimatorPhysicsEngine({});return t.shape=this.shape,t.mass=this.mass,t.position=this.position,t.size=this.size,t.autoSize=this.autoSize,t.radius=this.radius,t.length=this.length,t},ZICA.AnimatorPhysicsEngine.prototype.animateNode=function(t,e){var i;t.body?(t.x=t.body.position[0],t.y=t.body.position[1],t.angle=180*t.body.angle/Math.PI):(this.autoSize&&(this.size=new ZICA.Vect2d(t.width,t.height),this.radius=Math.min(t.width,t.height),this.length=Math.max(t.width,t.height)),t.body=new p2.Body({mass:this.mass,position:[t.x+this.position.X,t.y+this.position.Y],angle:t.angle*Math.PI/180}),"Circle"==this.shape&&(i=new p2.Circle({radius:this.radius})),"Box"==this.shape&&(i=new p2.Box({width:this.size.X,height:this.size.Y})),"Capsule"==this.shape&&(i=new p2.Capsule({radius:this.radius,length:this.length})),i&&t.body.addShape(i),Game.scene.world.addBody(t.body))},ZICA.AnimatorAnimateTexture=function(t){this.MyStartTime=Date.now(),this.Textures=t.Textures,this.TimePerFrame=t.TimePerFrame,this.Loop=t.Loop},ZICA.AnimatorAnimateTexture.prototype=new ZICA.Animator,ZICA.AnimatorAnimateTexture.prototype.getType=function(){return"animatetexture"},ZICA.AnimatorAnimateTexture.prototype.createClone=function(){var t=new ZICA.AnimatorAnimateTexture({});return t.Textures=this.Textures,t.Loop=this.Loop,t.TimePerFrame=this.TimePerFrame,t},ZICA.AnimatorAnimateTexture.prototype.animateNode=function(t,e){if(null==t||null==this.Textures)return!1;var i=!1,n=Date.now();if(this.Textures.length){var o=0==this.MyStartTime?0:this.MyStartTime,a=n-o,s=o+this.TimePerFrame*this.Textures.length,r=0;(r=!this.Loop&&n>=s?this.Textures.length-1:this.TimePerFrame>0?Math.floor(a/this.TimePerFrame%this.Textures.length):0)<this.Textures.length&&(t.image=this.Textures[r],i=!0)}return i},ZICA.AnimatorAnimateTexture.prototype.reset=function(){this.MyStartTime=Date.now()},ZICA.Action=function(){},ZICA.Action.prototype.execute=function(t){},ZICA.Action.prototype.createClone=function(){return null},ZICA.ActionHandler=function(t){t||(t=[]),this.Actions=t},ZICA.ActionHandler.prototype.execute=function(t){for(var e=0;e<this.Actions.length;++e)this.Actions[e].execute(t)},ZICA.ActionHandler.prototype.addAction=function(t){null!=t&&this.Actions.push(t)},ZICA.ActionHandler.prototype.findAction=function(t){for(var e=0;e<this.Actions.length;++e){var i=this.Actions[e];if(i.Type==t)return i}return null},ZICA.ActionHandler.prototype.createClone=function(){for(var t=new ZICA.ActionHandler,e=0;e<this.Actions.length;++e){var i=this.Actions[e];null!=i.createClone&&t.addAction(i.createClone())}return t},ZICA.Action.ExecuteJavaScript=function(t){this.Type="ExecuteJavaScript",this.JScript=t.JavaScript},ZICA.Action.ExecuteJavaScript.prototype.createClone=function(){var t=new ZICA.Action.ExecuteJavaScript;return t.JScript=this.JScript,t},ZICA.Action.ExecuteJavaScript.prototype.execute=function(t){this.eval.call(t,this.JScript)},ZICA.Action.ExecuteJavaScript.prototype.eval=function(JScript){eval(JScript)},ZICA.Action.MakeSceneNodeInvisible=function(t){this.InvisibleMakeType=["Make Invisible","Make Visible","Toggle Visiblilty"].indexOf(t.InvisibleMakeType),this.SceneNodeToMakeInvisible=t.SceneNodeToMakeInvisible,this.ChangeCurrentSceneNode=null==t.SceneNodeToMakeInvisible,this.Type="MakeSceneNodeInvisible"},ZICA.Action.MakeSceneNodeInvisible.prototype.createClone=function(){var t=new ZICA.Action.MakeSceneNodeInvisible({});return t.InvisibleMakeType=this.InvisibleMakeType,t.SceneNodeToMakeInvisible=this.SceneNodeToMakeInvisible,t.ChangeCurrentSceneNode=this.ChangeCurrentSceneNode,t},ZICA.Action.MakeSceneNodeInvisible.prototype.execute=function(t){if(t){var e=null;if(this.ChangeCurrentSceneNode?e=t:-1!=this.SceneNodeToMakeInvisible&&(e=Game.getEntityById(this.SceneNodeToMakeInvisible)),e)switch(this.InvisibleMakeType){case 0:e.visible=!1;break;case 1:e.visible=!0;break;case 2:e.visible=!e.visible}}},ZICA.Action.ChangeSceneNodeScale=function(t){switch(this.Type="ChangeSceneNodeScale",t.ScaleChangeType){case"Set absoulte scale":this.ScaleChangeType=0;break;case"Scale by the vector":this.ScaleChangeType=1;break;case"Set relative scale":this.ScaleChangeType=2}this.SceneNodeToChangeScale=t.SceneNodeToChangeScale,null==t.SceneNodeToChangeScale&&(this.ChangeCurrentSceneNode=!0),this.Size=t.Size.clone()},ZICA.Action.ChangeSceneNodeScale.prototype.createClone=function(){var t=new ZICA.Action.ChangeSceneNodeScale({});return t.ScaleChangeType=this.ScaleChangeType,t.SceneNodeToChangeScale=this.SceneNodeToChangeScale,t.ChangeCurrentSceneNode=this.ChangeCurrentSceneNode,t.Size=this.Size.clone(),t},ZICA.Action.ChangeSceneNodeScale.prototype.execute=function(t){if(t){var e=null;if(this.ChangeCurrentSceneNode?e=t:-1!=this.SceneNodeToChangeScale&&(e=Game.getEntityById(this.SceneNodeToChangeScale)),e)switch(this.ScaleChangeType){case 0:e.width=this.Size.X,e.height=this.Size.Y;break;case 1:e.width*=this.Size.X,e.height*=this.Size.Y;break;case 2:e.width+=this.Size.X,e.height+=this.Size.Y}}},ZICA.Action.ChangeSceneNodeRotation=function(t){this.Type="ChangeSceneNodeRotation",this.RotationChangeType="Set absoulte rotation"==t.RotationChangeType?0:1,this.SceneNodeToChangeRotation=t.SceneNodeToChangeRotation,null==t.SceneNodeToChangeRotation&&(this.ChangeCurrentSceneNode=!0),this.Angle=t.Angle,this.RotateAnimated=t.RotateAnimated,this.TimeNeededForRotationMs=t.TimeNeededForRotationMs},ZICA.Action.ChangeSceneNodeRotation.prototype.createClone=function(){var t=new ZICA.Action.ChangeSceneNodeRotation({});return t.RotationChangeType=this.RotationChangeType,t.SceneNodeToChangeRotation=this.SceneNodeToChangeRotation,t.ChangeCurrentSceneNode=this.ChangeCurrentSceneNode,t.Angle=this.Angle,t.RotateAnimated=this.RotateAnimated,t.TimeNeededForRotationMs=this.TimeNeededForRotationMs,t},ZICA.Action.ChangeSceneNodeRotation.prototype.execute=function(t){if(t){var e=null;if(this.ChangeCurrentSceneNode?e=t:-1!=this.SceneNodeToChangeRotation&&(e=Game.getEntityById(this.SceneNodeToChangeRotation)),e){var i=null;switch(this.RotationChangeType){case 0:i=this.Angle;break;case 1:i=e.angle+this.Angle}if(i)if(this.RotateAnimated){var n=new ZICA.AnimatorRotation({});n.setRotateToTargetAndStop(i,e.angle,this.TimeNeededForRotationMs),e.addAnimator(n)}else e.angle=i}}},ZICA.Action.ChangeSceneNodePosition=function(t){this.UseAnimatedMovement=t.UseAnimatedMovement,this.TimeNeededForMovementMs=t.TimeNeededForMovementMs,this.SceneNodeToChangePosition=t.SceneNodeToChangePosition,null==t.SceneNodeToChangePosition&&(this.ChangeCurrentSceneNode=!0),0==t.PositionChangeType&&(this.PositionChangeType=0,this.Vector=t.Position.clone()),1==t.PositionChangeType&&(this.PositionChangeType=1,this.Vector=t.Vector.clone()),2==t.PositionChangeType&&(this.PositionChangeType=2,this.Vector=t.Position.clone(),this.SceneNodeRelativeTo=t.SceneNodeRelativeTo,null==t.SceneNodeRelativeTo&&(this.RelativeToCurrentSceneNode=!0)),3==t.PositionChangeType&&(this.PositionChangeType=3,this.Vector=t.Percentage.clone(),this.SceneNodeRelativeTo=t.SceneNodeRelativeTo,null==t.SceneNodeRelativeTo&&(this.RelativeToCurrentSceneNode=!0)),4==t.PositionChangeType&&(this.PositionChangeType=4,this.Vector=t.MinPosition.clone(),this.Area3DEnd=t.MaxPosition.clone()),5==t.PositionChangeType&&(this.PositionChangeType=5),6==t.PositionChangeType&&(this.PositionChangeType=6,this.Vector=t.Vector),this.Type="ChangeSceneNodePosition"},ZICA.Action.ChangeSceneNodePosition.prototype.createClone=function(){var t=new ZICA.Action.ChangeSceneNodePosition({});return t.PositionChangeType=this.PositionChangeType,t.SceneNodeToChangePosition=this.SceneNodeToChangePosition,t.SceneNodeRelativeTo=this.SceneNodeRelativeTo,t.ChangeCurrentSceneNode=this.ChangeCurrentSceneNode,t.RelativeToCurrentSceneNode=this.RelativeToCurrentSceneNode,t.Vector=this.Vector?this.Vector.clone():null,t.Area3DEnd=this.Area3DEnd?this.Area3DEnd.clone():null,t.UseAnimatedMovement=this.UseAnimatedMovement,t.TimeNeededForMovementMs=this.TimeNeededForMovementMs,t},ZICA.Action.ChangeSceneNodePosition.prototype.execute=function(t){if(t){var e=null;if(this.ChangeCurrentSceneNode?e=t:-1!=this.SceneNodeToChangePosition&&(e=Game.getEntityById(this.SceneNodeToChangePosition)),e){var i=null;switch(this.PositionChangeType){case 0:i=this.Vector.clone();break;case 1:i=new ZICA.Vect2d(e.x+this.Vector.X,e.y+this.Vector.Y);break;case 2:var n=null;this.RelativeToCurrentSceneNode?n=t:-1!=this.SceneNodeRelativeTo&&(n=Game.getEntityById(this.SceneNodeRelativeTo)),n&&(i=new ZICA.Vect2d(n.x+this.Vector.X,n.y+this.Vector.Y));break;case 3:n=null;this.RelativeToCurrentSceneNode?n=Game:-1!=this.SceneNodeRelativeTo&&(n=Game.getEntityById(this.SceneNodeRelativeTo)),n&&(i=new ZICA.Vect2d(n.x+n.width*this.Vector.X/100,n.y+n.height*this.Vector.Y/100));break;case 4:(i=new ZICA.Vect2d).X=this.Vector.X+Math.random()*(this.Area3DEnd.X-this.Vector.X),i.Y=this.Vector.Y+Math.random()*(this.Area3DEnd.Y-this.Vector.Y);break;case 5:i=new ZICA.Vect2d(Game.controls.mouse.x,Game.controls.mouse.y);break;case 6:Game.scene.lastBulletImpact&&(i=new ZICA.Vect2d(Game.scene.lastBulletImpact.X+this.Vector.X,Game.scene.lastBulletImpact.Y+this.Vector.Y))}if(null!=i)if(this.UseAnimatedMovement&&this.TimeNeededForMovementMs>0){var o=new ZICA.AnimatorFlyStraight({});o.Start=new ZICA.Vect2d(e.x,e.y),o.End=i,o.TimeForWay=this.TimeNeededForMovementMs,o.DeleteMeAfterEndReached=!0,o.recalculateImidiateValues(),e.addAnimator(o)}else e.x=i.X,e.y=i.Y}}},ZICA.Action.ChangeSceneNodeProperty=function(t){this.Type="ChangeSceneNodeProperty",this.SceneNodeToChange=t.SceneNodeToChange,null==t.SceneNodeToChange&&(this.ChangeCurrentSceneNode=!0),this.Property=t.Property,this.Value=t.Value},ZICA.Action.ChangeSceneNodeProperty.prototype.createClone=function(){var t=new ZICA.Action.ChangeSceneNodeProperty({});return t.SceneNodeToChange=this.SceneNodeToChange,t.ChangeCurrentSceneNode=this.ChangeCurrentSceneNode,t.Property=this.Property,t.Value=this.Value,t},ZICA.Action.ChangeSceneNodeProperty.prototype.execute=function(t){if(t){var e=null;this.ChangeCurrentSceneNode?e=t:-1!=this.SceneNodeToChange&&(e=Game.getEntityById(this.SceneNodeToChange)),e&&(e[this.Property]=this.Value)}},ZICA.Action.ChangeSceneNodePropertyFromNode=function(t){this.Type="ChangeSceneNodePropertyFromNode",this.SceneNodeToChange=t.SceneNodeToChange,null==t.SceneNodeToChange&&(this.ChangeCurrentSceneNode=!0),this.Property=t.Property,this.SceneNodeFrom=t.SceneNodeFrom,null==t.SceneNodeFrom&&(this.FromCurrentSceneNode=!0)},ZICA.Action.ChangeSceneNodePropertyFromNode.prototype.createClone=function(){var t=new ZICA.Action.ChangeSceneNodePropertyFromNode({});return t.SceneNodeToChange=this.SceneNodeToChange,t.ChangeCurrentSceneNode=this.ChangeCurrentSceneNode,t.SceneNodeFrom=this.SceneNodeFrom,t.FromCurrentSceneNode=this.FromCurrentSceneNode,t.Property=this.Property,t},ZICA.Action.ChangeSceneNodePropertyFromNode.prototype.execute=function(t){if(t){var e=null;this.FromCurrentSceneNode?e=t:-1!=this.SceneNodeFrom&&(e=Game.getEntityById(this.SceneNodeFrom));var i=null;this.ChangeCurrentSceneNode?i=t:-1!=this.SceneNodeToChange&&(i=Game.getEntityById(this.SceneNodeToChange)),i&&(i[this.Property]=e[this.Property])}},ZICA.Action.ChangeSceneNodePropertyVariable=function(t){this.Type="ChangeSceneNodePropertyVariable",this.SceneNodeToChange=t.SceneNodeToChange,null==t.SceneNodeToChange&&(this.ChangeCurrentSceneNode=!0),this.Property=t.Property,this.Variable=t.Variable},ZICA.Action.ChangeSceneNodePropertyVariable.prototype.createClone=function(){var t=new ZICA.Action.ChangeSceneNodePropertyVariable({});return t.SceneNodeToChange=this.SceneNodeToChange,t.ChangeCurrentSceneNode=this.ChangeCurrentSceneNode,t.Property=this.Property,t.Variable=this.Variable,t},ZICA.Action.ChangeSceneNodePropertyVariable.prototype.execute=function(t){if(t){var e=null;this.ChangeCurrentSceneNode?e=t:-1!=this.SceneNodeToChange&&(e=Game.getEntityById(this.SceneNodeToChange)),e&&Game.hasVariable(this.Variable)&&(e[this.Property]=Game.getVariable(this.Variable))}},ZICA.Action.SwitchToScene=function(t){this.Scene=t.SceneId,this.ResetScene=t.ResetScene,this.Type="SwitchToScene"},ZICA.Action.SwitchToScene.prototype.createClone=function(){var t=new ZICA.Action.SwitchToScene({});return t.Scene=this.Scene,t.ResetScene=this.ResetScene,t},ZICA.Action.SwitchToScene.prototype.execute=function(t){var e=Game.getScene(this.Scene);e&&Game.switchToScene(e,this.ResetScene)},ZICA.Action.RestartScene=function(){this.Type="RestartScene"},ZICA.Action.RestartScene.prototype.createClone=function(){return new ZICA.Action.RestartScene},ZICA.Action.RestartScene.prototype.execute=function(t){Game.scene&&Game.switchToScene(Game.scene,!0)},ZICA.Action.OpenWebpage=function(t){this.Type="OpenWebpage",this.Webpage=t.Webpage,this.Target=t.Target},ZICA.Action.OpenWebpage.prototype.createClone=function(){var t=new ZICA.Action.OpenWebpage({});return t.Webpage=this.Webpage,t.Target=this.Target,t},ZICA.Action.OpenWebpage.prototype.execute=function(t){window.open(this.Webpage,this.Target)},ZICA.Action.ExitApplication=function(t){this.Type="ExitApplication"},ZICA.Action.ExitApplication.prototype.createClone=function(){return new ZICA.Action.ExitApplication({})},ZICA.Action.ExitApplication.prototype.execute=function(t){window.close()},ZICA.Action.SetOrChangeAVariable=function(t){this.VariableName=t.VariableName,this.Operation=["Set(=)","Add(+)","Substract(-)","Divide(/)","Divide INT(/)","Multiply(*)","Multiply INT(*)"].indexOf(t.Operation),this.ValueType="Value"==t.ValueType?0:1,this.Value=t.Value,this.Type="SetOrChangeAVariable"},ZICA.Action.SetOrChangeAVariable.prototype.createClone=function(){var t=new ZICA.Action.SetOrChangeAVariable({});return t.VariableName=this.VariableName,t.Operation=this.Operation,t.ValueType=this.ValueType,t.Value=this.Value,t},ZICA.Action.SetOrChangeAVariable.prototype.execute=function(t){if(t&&null!=this.VariableName){var e=Game.hasVariable(this.VariableName);e=1==e?Game.getVariable(this.VariableName):0;var i=null;if(1==this.ValueType){if(null==(i=Game.getVariable(this.Value)))return}else i=this.Value;switch(this.Operation){case 0:e=i;break;case 1:e+=i;break;case 2:e-=i;break;case 3:e/=i;break;case 4:e=Math.round(e/i);break;case 5:e*=i;break;case 6:e=Math.round(e*i)}Game.setVariable(this.VariableName,e)}},ZICA.Action.IfVariable=function(t){this.VariableName=t.VariableName,this.ComparisonType=["Is equal to (=)","Is not equal to (<>)","Is bigger than (>)","Is smaller than (<)"].indexOf(t.ComparisonType),this.ValueType="Value"==t.ValueType?0:1,this.Value=t.Value,this.TheActionHandler=t.Action,this.TheElseActionHandler=t.Else,this.Type="IfVariable"},ZICA.Action.IfVariable.prototype.createClone=function(){var t=new ZICA.Action.IfVariable({});return t.VariableName=this.VariableName,t.ComparisonType=this.ComparisonType,t.ValueType=this.ValueType,t.Value=this.Value,t.TheActionHandler=this.TheActionHandler?this.TheActionHandler.createClone():null,t.TheElseActionHandler=this.TheElseActionHandler?this.TheElseActionHandler.createClone():null,t},ZICA.Action.IfVariable.prototype.execute=function(t){if(t&&null!=this.VariableName){var e=Game.hasVariable(this.VariableName);if(null!=e){e=Game.getVariable(this.VariableName);var i=null;if(1==this.ValueType){if(0==(i=Game.hasVariable(this.Value)))return;i=Game.getVariable(this.Value)}else i=this.Value;var n=!1;switch(this.ComparisonType){case 0:case 1:n=e==i,1==this.ComparisonType&&(n=!n);break;case 2:n=e>i;break;case 3:n=e<i}n?this.TheActionHandler&&this.TheActionHandler.execute(t):this.TheElseActionHandler&&this.TheElseActionHandler.execute(t)}}},ZICA.Action.ActionStoreLoadVariable=function(t){this.Type="StoreLoadVariable",this.Load="Load Variable"==t.Load,this.VariableName=t.VariableName},ZICA.Action.ActionStoreLoadVariable.prototype.createClone=function(){var t=new ZICA.Action.ActionStoreLoadVariable({});return t.Load=this.Load,t.VariableName=this.VariableName,t},ZICA.Action.ActionStoreLoadVariable.prototype.setCookie=function(t,e,i){var n=new Date;n.setDate(n.getDate()+i);var o=escape(e)+"; expires="+n.toUTCString();document.cookie=t+"="+o},ZICA.Action.ActionStoreLoadVariable.prototype.getCookie=function(t){for(var e=document.cookie.split(";"),i=0;i<e.length;++i){var n=e[i],o=n.indexOf("="),a=n.substr(0,o);if((a=a.replace(/^\s+|\s+$/g,""))==t)return unescape(n.substr(o+1))}return null},ZICA.Action.ActionStoreLoadVariable.prototype.execute=function(t){if(null!=this.VariableName&&""!=this.VariableName){var e=Game.hasVariable(this.VariableName);try{if(this.Load){var i=window.localStorage.getItem(this.VariableName);i&&Game.setVariable(this.VariableName,i)}else e&&window.localStorage.setItem(this.VariableName,Game.getVariable(this.VariableName))}catch(t){}}},ZICA.Action.ActionPlaySound=function(t){this.SceneNodeToPlay=t.SceneNodeToPlay,null==t.SceneNodeToPlay&&(this.PlayCurrentSceneNode=!0),this.Mode=["Play Audio","Stop Audio","Toggle Audio"].indexOf(t.Mode),this.Type="PlaySound"},ZICA.Action.ActionPlaySound.prototype.createClone=function(){var t=new ZICA.Action.ActionPlaySound({});return t.SceneNodeToPlay=this.SceneNodeToPlay,t.PlayCurrentSceneNode=this.PlayCurrentSceneNode,t.Mode=this.Mode,t},ZICA.Action.ActionPlaySound.prototype.execute=function(t){if(t){var e=null;if(this.PlayCurrentSceneNode?e=t:-1!=this.SceneNodeToPlay&&(e=Game.getEntityById(this.SceneNodeToPlay)),e){if(!e.__audio)return;e.__audio.currentTime=0,0==this.Mode?e.playAudio():1==this.Mode?e.stopAudio():e.__audio.paused?e.playAudio():e.stopAudio()}}},ZICA.Action.ActionResumeSound=function(t){this.SceneNodeToPlay=t.SceneNodeToPlay,null==t.SceneNodeToPlay&&(this.PlayCurrentSceneNode=!0),this.Mode=["Resume Audio","Pause Audio","Toggle Audio"].indexOf(t.Mode),this.Type="PlaySound"},ZICA.Action.ActionResumeSound.prototype.createClone=function(){var t=new ZICA.Action.ActionResumeSound({});return t.SceneNodeToPlay=this.SceneNodeToPlay,t.PlayCurrentSceneNode=this.PlayCurrentSceneNode,t.Mode=this.Mode,t},ZICA.Action.ActionResumeSound.prototype.execute=function(t){if(t){var e=null;if(this.PlayCurrentSceneNode?e=t:-1!=this.SceneNodeToPlay&&(e=Game.getEntityById(this.SceneNodeToPlay)),e){if(!e.__audio)return;0==this.Mode?e.playAudio():1==this.Mode?e.pauseAudio():e.__audio.paused?e.playAudio():e.pauseAudio()}}},ZICA.Action.ActionStopSound=function(){this.Type="StopSound"},ZICA.Action.ActionStopSound.prototype.createClone=function(){return new ZICA.Action.ActionStopSound},ZICA.Action.ActionStopSound.prototype.execute=function(t){Game.stopAllSounds()},ZICA.Action.ActionDeleteSceneNode=function(t){this.Type="ActionDeleteSceneNode",this.SceneNodeToDelete=t.SceneNodeToDelete,null==this.SceneNodeToDelete&&(this.DeleteCurrentSceneNode=!0)},ZICA.Action.ActionDeleteSceneNode.prototype.createClone=function(){var t=new ZICA.Action.ActionDeleteSceneNode({});return t.SceneNodeToDelete=this.SceneNodeToDelete,t.DeleteCurrentSceneNode=this.DeleteCurrentSceneNode,t.TimeAfterDelete=this.TimeAfterDelete,t},ZICA.Action.ActionDeleteSceneNode.prototype.execute=function(t){if(t){var e=null;this.DeleteCurrentSceneNode?e=t:-1!=this.SceneNodeToDelete&&(e=Game.getEntityById(this.SceneNodeToDelete)),null!=e&&(e.__removeFlag=!0)}},ZICA.Action.RestartBehaviors=function(t){this.SceneNodeToRestart=t.SceneNodeToRestart,null==this.SceneNodeToRestart&&(this.ChangeCurrentSceneNode=!0),this.Type="RestartBehaviors"},ZICA.Action.RestartBehaviors.prototype.createClone=function(){var t=new ZICA.Action.RestartBehaviors({});return t.SceneNodeToRestart=this.SceneNodeToRestart,t.ChangeCurrentSceneNode=this.ChangeCurrentSceneNode,t},ZICA.Action.RestartBehaviors.prototype.execute=function(t){if(t){var e=null;if(this.ChangeCurrentSceneNode?e=t:-1!=this.SceneNodeToRestart&&(e=Game.getEntityById(this.SceneNodeToRestart)),e)for(var i=0;i<e.animators.length;++i){var n=e.animators[i];null!=n&&n.reset()}}},ZICA.Action.ActionCloneSceneNode=function(t){this.SceneNodeToClone=t.SceneNodeToClone,null==this.SceneNodeToClone&&(this.CloneCurrentSceneNode=!0),this.TheActionHandler=t.ActionToDoWhitClone,this.Type="ActionCloneSceneNode"},ZICA.Action.ActionCloneSceneNode.prototype.createClone=function(){var t=new ZICA.Action.ActionCloneSceneNode({});return t.SceneNodeToClone=this.SceneNodeToClone,t.CloneCurrentSceneNode=this.CloneCurrentSceneNode,t.TheActionHandler=this.TheActionHandler?this.TheActionHandler.createClone():null,t},ZICA.Action.ActionCloneSceneNode.prototype.execute=function(t){if(t){var e=null;if(this.CloneCurrentSceneNode?e=t:-1!=this.SceneNodeToClone&&(e=Game.getEntityById(this.SceneNodeToClone)),e){var i=Game.cloneEntity(e);null!=i&&this.TheActionHandler&&this.TheActionHandler.execute(i)}}},ZICA.Action.SetSceneNodeAnimation=function(t){this.SceneNodeToChangeAnim=t.SceneNodeToChangeAnim,null==this.SceneNodeToChangeAnim&&(this.ChangeCurrentSceneNode=!0),this.Loop=t.Loop,this.AnimName=t.AnimName,this.Type="SetSceneNodeAnimation"},ZICA.Action.SetSceneNodeAnimation.prototype.createClone=function(){var t=new ZICA.Action.SetSceneNodeAnimation({});return t.SceneNodeToChangeAnim=this.SceneNodeToChangeAnim,t.ChangeCurrentSceneNode=this.ChangeCurrentSceneNode,t.Loop=this.Loop,t.AnimName=this.AnimName,t},ZICA.Action.SetSceneNodeAnimation.prototype.execute=function(t){if(t){var e=null;if(this.ChangeCurrentSceneNode?e=t:-1!=this.SceneNodeToChangeAnim&&(e=Game.getEntityById(this.SceneNodeToChangeAnim)),e){var i=e;i.animation=this.AnimName,i.animLoop=this.Loop}}},ZICA.Action.ActionPlayMovie=function(t){this.Type="ActionPlayMovie",this.PlayLooped=t.PlayLooped,this.VideoFileName=t.VideoFileName,this.AutoPlay=t.AutoPlay,this.SceneNodeToPlayAt=t.SceneNodeToPlayAt,null==this.SceneNodeToPlayAt&&(this.PlayAtCurrentSceneNode=!0),this.ActionHandlerFinished=t.ActionOnFinished,this.ActionHandlerFailed=t.ActionOnFailed},ZICA.Action.ActionPlayMovie.prototype.createClone=function(){var t=new ZICA.Action.ActionPlayMovie;return t.PlayLooped=this.PlayLooped,t.AutoPlay=this.AutoPlay,t.VideoFileName=this.VideoFileName,t.SceneNodeToPlayAt=this.SceneNodeToPlayAt,t.PlayAtCurrentSceneNode=this.PlayAtCurrentSceneNode,t.ActionHandlerFinished=this.ActionHandlerFinished?this.ActionHandlerFinished.createClone():null,t.ActionHandlerFailed=this.ActionHandlerFailed?this.ActionHandlerFailed.createClone():null,t},ZICA.Action.ActionPlayMovie.prototype.execute=function(t,e){if(t){var i=null;this.PlayAtCurrentSceneNode?i=t:-1!=this.SceneNodeToPlayAt&&(i=Game.scene.getEntityById(this.SceneNodeToPlayAt)),i.stream=new ZICA.VideoStream(this.VideoFileName),null!=i.stream&&this.AutoPlay&&i.stream.play(this.PlayLooped)}},ZICA.Action.ActionVideoCommand=function(t){this.Type="ActionVideoCommand",this.SceneNodeToPlayAt=t.SceneNodeToChange,null==this.SceneNodeToPlayAt&&(this.PlayAtCurrentSceneNode=!0),this.Command=["Play","Pause","Stop","Resume"].indexOf(t.Command)},ZICA.Action.ActionVideoCommand.prototype.createClone=function(){var t=new ZICA.Action.ActionPlayMovie({});return t.Command=this.Command,t.SceneNodeToPlayAt=this.SceneNodeToPlayAt,t.PlayAtCurrentSceneNode=this.PlayAtCurrentSceneNode,t},ZICA.Action.ActionVideoCommand.prototype.execute=function(t){if(t){var e=null;if(this.PlayAtCurrentSceneNode?e=t:-1!=this.SceneNodeToPlayAt&&(e=Game.getEntityById(this.SceneNodeToPlayAt)),null!=e.stream)switch(this.Command){case 0:e.stream.play(this.PlayLooped);break;case 1:e.stream.pause();break;case 2:e.stream.stop()}}},ZICA.VideoStream=function(t){this.filename=t,this.videoElement=null,this.handlerOnVideoEnded=null,this.handlerOnVideoFailed=null,this.readyToShow=!1,this.playBackEnded=!1,this.stopped=!1,this.state=0,this.playLooped=!1,this.isError=!1,this.videoBufferReady=function(){this.state=2,this.videoElement.play(),this.readyToShow=!0},this.videoPlaybackDone=function(){this.state=0,this.playBackEnded=!0},this.errorHappened=function(){this.state=0,this.playBackEnded=!0,this.isError=!0},this.play=function(e){if(2!=this.state&&1!=this.state){if(this.videoElement){if(3==this.state)return this.videoElement.play(),this.state=2,void(this.playBackEnded=!1);if(0==this.state)return this.videoElement.currentTime=0,this.videoElement.play(),this.state=2,void(this.playBackEnded=!1)}var i=document.createElement("video"),n=this;this.videoElement=i,this.playLooped=e,i.addEventListener("canplaythrough",function(){n.videoBufferReady()},!0),i.addEventListener("ended",function(){n.videoPlaybackDone()},!0),i.addEventListener("error",function(){n.errorHappened()},!0),i.preload="auto",i.src=Game.assets[t],i.style.display="none",this.playLooped&&(i.loop=!0),this.state=1}},this.pause=function(){2==this.state&&(this.videoElement.pause(),this.state=3)},this.stop=function(){2==this.state&&(this.videoElement.pause(),this.state=0)},this.updateVideoTexture=function(){this.readyToShow&&this.state},this.hasPlayBackEnded=function(){return 0==this.state||this.playBackEnded}},ZICA.Action.Shoot=function(t){this.ShootType=0,this.Damage=0,this.BulletSpeed=0,this.SceneNodeToUseAsBullet=-1,this.WeaponRange=100,this.Type="Shoot",this.SceneNodeToShootFrom=-1,this.SceneNodeToShootTo=-1,this.ShootToCameraTarget=!1,this.AdditionalDirectionRotation=null,this.ActionHandlerOnImpact=null,this.ShootDisplacement=new ZICA.Vect2d,this.ShootType="Direcly hit, no bullet"==t.ShootType?0:1,this.Damage=t.Damage,this.SceneNodeToUseAsBullet=t.SceneNodeToUseAsBullet,this.BulletSpeed=t.BulletSpeed,this.WeaponRange=t.WeaponRange,this.ActionHandlerOnImpact=t.ActionOnImpact,this.SceneNodeToShootFrom=t.SceneNodeToShootFrom,this.AdditionalDirectionRotation=t.AdditionalDirectionRotation,this.ShootDisplacement=t.ShootDisplacement,this.ShootTo=["DirectionRotation","CameraTarget","SceneNode"].indexOf(t.ShootTo),1==this.ShootTo&&(this.ShootToCameraTarget=!0),2==this.ShootTo&&(this.SceneNodeToShootTo=t.SceneNodeToShootTo)},ZICA.Action.Shoot.prototype.createClone=function(){var t=new ZICA.Action.Shoot({});return t.ShootType=this.ShootType,t.Damage=this.Damage,t.BulletSpeed=this.BulletSpeed,t.SceneNodeToUseAsBullet=this.SceneNodeToUseAsBullet,t.WeaponRange=this.WeaponRange,t.SceneNodeToShootFrom=this.SceneNodeToShootFrom,t.SceneNodeToShootTo=this.SceneNodeToShootTo,t.ShootToCameraTarget=this.ShootToCameraTarget,t.ShootTo=this.ShootTo,t.AdditionalDirectionRotation=this.AdditionalDirectionRotation,t.ActionHandlerOnImpact=this.ActionHandlerOnImpact?this.ActionHandlerOnImpact.createClone():null,t.ShootDisplacement=this.ShootDisplacement.clone(),t},ZICA.Action.Shoot.prototype.execute=function(t){if(t){var e=new Object,i=null;if(null!=this.SceneNodeToShootFrom){var n=Game.getEntityById(this.SceneNodeToShootFrom);null!=n&&(!0,i=n,e.Start=new ZICA.Vect2d(n.x,n.y),e.Start.addToThis(this.ShootDisplacement))}else i=t,e.Start=new ZICA.Vect2d(i.x,i.y),e.Start.addToThis(this.ShootDisplacement);if(1==this.ShootTo){var o=new ZICA.Vect2d(Game.scene.x,Game.scene.y);(o=o.substract(e.Start)).normalize(),e.End=o}if(0==this.ShootTo&&"number"==typeof this.AdditionalDirectionRotation&&(e.End=new ZICA.Vect2d(Math.cos(this.AdditionalDirectionRotation*Math.PI/180),Math.sin(this.AdditionalDirectionRotation*Math.PI/180))),2==this.ShootTo){var a=null;if(-1!=this.SceneNodeToShootTo&&(a=Game.getEntityById(this.SceneNodeToShootTo)),a){var s=new ZICA.Vect2d(a.getCenter().x,a.getCenter().y);(s=s.substract(e.Start)).normalize(),e.End=s}}if(1==this.ShootType){var r=null;if(r=-1!=this.SceneNodeToUseAsBullet?Game.getEntityById(this.SceneNodeToUseAsBullet):t){var h=r.clone();if(null!=h){h.x=e.Start.X,h.y=e.Start.Y,h.position="absoulte",h.visible=!0,h.isBullet=!0,h.name="",h.ray=e,h.WeaponRange=this.WeaponRange,h.Damage=this.Damage,h.shooterNode=i,h.bulletTemplate=r,h.ActionHandlerOnImpact=this.ActionHandlerOnImpact;var c=this.BulletSpeed;0==c&&(c=1),h.velX=e.End.X*c,h.velY=e.End.Y*c,Game.scene.addEntity(h),h.__onUpdate=function(t){var e=new ZICA.Vect2d(this.x,this.y),i=this.ray.Start.clone();e.substract(i).getLength()>=this.WeaponRange&&(this.__removeFlag=!0)},h.__onCollision=function(t){var e=t.other;if(!e.isBullet&&e!=this.shooterNode&&e!=this.bulletTemplate){Game.scene.lastBulletImpact=new ZICA.Vect2d(this.x,this.y),this.__removeFlag=!0,this.ActionHandlerOnImpact&&this.ActionHandlerOnImpact.execute(e);var i=e.getAnimatorOfType("gameai");i&&i.OnHit(this.Damage,e)}}}}}else if(0==this.ShootType)for(var l=0;l<=this.WeaponRange;l++){var d=e.End.clone();d.multiplyThisWithScal(l);var u=e.Start.add(d);u.x=u.X,u.y=u.Y;for(var m=0;m<=Game.scene.children.length-1;m++){var p=Game.scene.children[m];if(Game.pointInBox(u,p)&&!p.isBullet&&p!=i){Game.scene.lastBulletImpact=new ZICA.Vect2d(u.X,u.Y),this.ActionHandlerOnImpact&&this.ActionHandlerOnImpact.execute(p);var A=other.getAnimatorOfType("gameai");A&&A.OnHit(this.Damage,p),l=1/0;break}}}}},ZICA.Action.ChangeCameraPosition=function(t){this.UseAnimatedMovement=t.UseAnimatedMovement,this.TimeNeededForMovementMs=t.TimeNeededForMovementMs,this.center=t.Center,this.Vector=t.Position.clone(),this.SceneNodeRelativeTo=t.SceneNodeRelativeTo,null==t.SceneNodeRelativeTo&&(this.RelativeToCurrentSceneNode=!0),this.Type="ChangeCameraPosition"},ZICA.Action.ChangeCameraPosition.prototype.createClone=function(){var t=new ZICA.Action.ChangeCameraPosition({});return t.SceneNodeRelativeTo=this.SceneNodeRelativeTo,t.RelativeToCurrentSceneNode=this.RelativeToCurrentSceneNode,t.Vector=this.Vector?this.Vector.clone():null,t.center=this.center,t.UseAnimatedMovement=this.UseAnimatedMovement,t.TimeNeededForMovementMs=this.TimeNeededForMovementMs,t},ZICA.Action.ChangeCameraPosition.prototype.execute=function(t){if(t){var e=Game.scene;if(e){var i=null,n=null;if(this.RelativeToCurrentSceneNode?n=t:-1!=this.SceneNodeRelativeTo&&(n=Game.getEntityById(this.SceneNodeRelativeTo)),n){var o=n.x,a=n.y;this.center&&(o+=n.width/2,a+=n.height/2),i=new ZICA.Vect2d(o+this.Vector.X,a+this.Vector.Y)}if(null!=i)if(this.UseAnimatedMovement&&this.TimeNeededForMovementMs>0){var s=new ZICA.AnimatorFlyStraight({});s.Start=new ZICA.Vect2d(e.x,e.y),s.End=i,s.TimeForWay=this.TimeNeededForMovementMs,s.DeleteMeAfterEndReached=!0,s.recalculateImidiateValues(),e.addAnimator(s)}else e.x=i.X,e.y=i.Y}}},ZICA.Camera=function(t,e){e=e||{},this.distance=1e3,this.lookAt=[0,0],this.context=t,this.fieldOfView=e.fieldOfView||Math.PI/4,this.viewport={left:0,right:0,top:0,bottom:0,width:0,height:0,scale:[1,1]},this.updateViewport(),this.hasBegin=!1},ZICA.Camera.prototype.begin=function(){this.hasBegin=!0,this.context.save(),this.applyScale(),this.applyTranslation()},ZICA.Camera.prototype.end=function(){this.hasBegin=!1,this.context.restore()},ZICA.Camera.prototype.applyScale=function(){this.context.scale(this.viewport.scale[0],this.viewport.scale[1])},ZICA.Camera.prototype.applyTranslation=function(){this.context.translate(-this.viewport.left,-this.viewport.top)},ZICA.Camera.prototype.updateViewport=function(){this.aspectRatio=this.context.canvas.width/this.context.canvas.height,this.viewport.width=this.context.canvas.width,this.viewport.height=this.context.canvas.height,this.viewport.left=this.lookAt[0]-this.viewport.width/2,this.viewport.top=this.lookAt[1]-this.viewport.height/2,this.viewport.right=this.viewport.left+this.viewport.width,this.viewport.bottom=this.viewport.top+this.viewport.height,this.viewport.scale[0]=this.context.canvas.width/this.viewport.width,this.viewport.scale[1]=this.context.canvas.height/this.viewport.height},ZICA.Camera.prototype.zoomTo=function(t){this.distance=t,this.updateViewport()},ZICA.Camera.prototype.moveTo=function(t,e){this.lookAt[0]=t,this.lookAt[1]=e,this.updateViewport()},ZICA.Camera.prototype.set=function(t,e){var i=Game.scene||Editor.scene;t<this.viewport.width/2&&(t=this.viewport.width/2),e<this.viewport.height/2&&(e=this.viewport.height/2),t>i.width-this.viewport.width/2&&(t=i.width-this.viewport.width/2),e>i.height-this.viewport.height/2&&(e=i.height-this.viewport.height/2),i.x=t,i.y=e,this.hasBegin&&this.end(),this.moveTo(t,e),this.begin()},ZICA.Camera.prototype.screenToWorld=function(t,e,i){return(i=i||{}).x=t/this.viewport.scale[0]+this.viewport.left,i.y=e/this.viewport.scale[1]+this.viewport.top,i},ZICA.Camera.prototype.worldToScreen=function(t,e,i){return(i=i||{}).x=(t-this.viewport.left)*this.viewport.scale[0],i.y=(e-this.viewport.top)*this.viewport.scale[1],i},ZICA.Camera.prototype.addListeners=function(){window.onwheel=function(t){if(t.ctrlKey){let e=this.distance-20*t.deltaY;e<=1&&(e=1),this.zoomTo(e)}else{var e=this.lookAt[0]+2*t.deltaX,i=this.lookAt[1]+2*t.deltaY;this.set(e,i)}},window.addEventListener("keydown",function(t){var e=Game.scene||Editor.scene;37==t.keyCode&&(e.x-=5,Editor.update(),Editor.sceneGui.updateDisplay()),38==t.keyCode&&(e.y-=5,Editor.update(),Editor.sceneGui.updateDisplay()),39==t.keyCode&&(e.x+=5,Editor.update(),Editor.sceneGui.updateDisplay()),40==t.keyCode&&(e.y+=5,Editor.update(),Editor.sceneGui.updateDisplay())},!1),window.addEventListener("keydown",t=>{"r"===t.key&&t.ctrlKey&&(t.preventDefault(),this.zoomTo(1e3),this.set(0,0),Editor.update(),Editor.sceneGui.updateDisplay())});var t=!1,e=0,i=0,n=0,o=0,a=document.getElementById("field");a.addEventListener("mousedown",function(a){3==event.which&&(t=!0,e=a.clientX,i=a.clientY,n=Editor.scene.x,o=Editor.scene.y)}),a.addEventListener("mouseup",function(e){3==event.which&&(t=!1,a.style.cursor="",Editor.isMoving=!1)}),a.addEventListener("mousemove",function(s){if(3==event.which&&t){Editor.isMoving=!0,a.style.cursor="move";var r=e-s.clientX,h=i-s.clientY;Editor.camera.worldToScreen(Editor.scene.x,Editor.scene.y);Editor.scene.x=n+r,Editor.scene.y=o+h,Editor.update(),Editor.sceneGui.updateDisplay()}}),a.addEventListener("mouseleave",function(e){3==event.which&&(t=!1)})},ZICA.Entity=function(){this.name="",this.type="entity",this.physicType="kinematic",this.isEntity=!0,this.attachTo=null,this.position="absolute",this.X=0,this.Y=0,this.x=0,this.y=0,this.width=50,this.height=50,this.halfWidth=.5*this.width,this.halfHeight=.5*this.height,this.angle=0,this.visible=!0,this.locked=!1,this.drawImage=!0,this.aspectRatio=!1,this.image="",this.loop=!1,this.muted=!1,this.autoplay=!0,this.volume=1,this.audio="",this.animators="[]",this.animLoop=!0,this.animations={},this.animation="",this.fps=12,this.elapsed=0,this.__then=Date.now(),this.text="",this.font="Arial",this.fontSize=15,this.fontBold=!1,this.fontItalic=!1,this.fontColor="rgba(255,0,0,1)",this.textAlign="center",this.verticalAlign="top",this.lineHeight=15,this.velX=0,this.velY=0,this.ax=0,this.ay=0,this.restitution=.2,this.opacity=1,this.drawColor=!0,this.color="rgba(0,0,0,1)",this.drawBorder=!1,this.borderWidth=2.5,this.borderColor="rgba(255,0,0,1)",this.borderStyle="solid",this.priority=1,this.blockedUp=!1,this.blockedDown=!1,this.blockedLeft=!1,this.blockedRight=!1,this.prevX=0,this.prevY=0,this.collides=!0,this.collision=!0,this.__image=new Image,this.__audio=new Audio,this.stream=null,this.__removeFlag=!1,this.__guid=this.__generateGUID(),this.updateBounds()},ZICA.Entity.prototype.remove=function(){this.__removeFlag=!0},ZICA.Entity.prototype.isRemoved=function(){return this.__removeFlag},ZICA.Entity.prototype.clone=function(){var t=this.cloneAnimators(),e=this.constructor.constructEntity(this);return e.__guid=e.__generateGUID(),e.animators=t,e},ZICA.Entity.prototype.duplicate=function(){var t=new ZICA.Entity;for(var e in this)if("object"==typeof this[e]){var i=JSON.parse(JSON.stringify(this[e]));t[e]=i}else t[e]=this[e];return t},ZICA.Entity.prototype.__onGameStart=function(t){},ZICA.Entity.prototype.__onUpdate=function(t){},ZICA.Entity.prototype.__onCollision=function(t){},ZICA.Entity.prototype.__draw=function(t){if(this.visible){if(this.beforeDraw&&this.beforeDraw.call(this,t),"absolute"==this.position&&this.__updateFromAbsolute(),"fixed"==this.position&&this.__updateFromFixed(),t.save(),t.translate(this.x+this.width/2,this.y+this.height/2),t.rotate(this.angle*Math.PI/180),t.translate(-this.x+-this.width/2,-this.y+-this.height/2),t.globalAlpha=this.opacity,this.drawColor&&(t.fillStyle=this.color,t.fillRect(this.x,this.y,this.width,this.height)),this.drawBorder){if(t.lineWidth=this.borderWidth,t.strokeStyle=this.borderColor,"dashed"==this.borderStyle){var e=Math.max(this.width,this.height),i=Math.min(this.width,this.height);t.setLineDash([e/10,i/10])}t.strokeRect(this.x+this.borderWidth/2,this.y+this.borderWidth/2,this.width-this.borderWidth,this.height-this.borderWidth)}if(this.__audio instanceof Audio==0&&(this.__audio=new Audio),2==Game.state&&(this.__audio.muted=this.muted,this.__audio.loop=this.loop,this.__audio.autoplay=this.autoplay,this.__audio.volume=this.volume,this.__audio.name!=this.audio&&(this.__audio.name=this.audio,this.audio?this.__audio.src=this.audio in Game.assets?Game.assets[this.audio]:"":this.__audio.src="")),this.__image instanceof Image==0&&(this.__image=new Image),this.__image.name!=this.image&&(this.__image.name=this.image,this.image?this.__image.src=this.image in Game.assets?Game.assets[this.image]:"":this.__image.src=""),this.aspectRatio){if(this.drawImage){var n=this.__image.naturalWidth,o=this.__image.naturalHeight,a=Math.min(this.width/n,this.height/o),s=Game.camera.viewport.left,r=Game.camera.viewport.top;t.save(),t.setTransform(a,0,0,a,this.x-s+this.width/2,this.y-r+this.height/2),t.rotate(this.angle*Math.PI/180),t.drawImage(this.__image,-n/2,-o/2,n,o),t.restore()}}else this.drawImage&&t.drawImage(this.__image,this.x,this.y,this.width,this.height);if(this.__video instanceof Image==0&&(this.__video=new Image),this.aspectRatio){if(this.stream){n=this.__video.naturalWidth,o=this.__video.naturalHeight,a=Math.min(this.width/n,this.height/o),s=Game.camera.viewport.left,r=Game.camera.viewport.top;t.save(),t.setTransform(a,0,0,a,this.x-s+this.width/2,this.y-r+this.height/2),t.rotate(this.angle*Math.PI/180),t.drawImage(this.stream.videoElement,-n/2,-o/2,n,o),t.restore()}}else this.stream&&this.stream.videoElement&&t.drawImage(this.stream.videoElement,this.x,this.y,this.width,this.height);var h=Date.now();this.elapsed=Math.abs(h-this.__then);var c=1e3/this.fps;this.elapsed>c&&Game.isRunning()&&(this.updateAnimation(),this.__then=h-this.elapsed%c),this.drawAnimation(t),t.fillStyle=this.fontColor;var l=(this.fontItalic?"italic ":"")+(this.fontBold?" bold ":"")+this.fontSize+"px "+this.font;l=(l=l.trim()).replace("  "," "),t.font=l,t.mlFillText(this.text,this.x,this.y,this.width,this.height,this.verticalAlign,this.textAlign,this.lineHeight),t.restore(),this.afterDraw&&this.afterDraw.call(this,t)}},ZICA.Entity.prototype.playAudio=function(){this.__audio.duration==this.__audio.currentTime&&(this.__audio.currentTime=0),this.__audio.play()},ZICA.Entity.prototype.pauseAudio=function(){this.__audio.pause()},ZICA.Entity.prototype.stopAudio=function(){this.__audio.pause(),this.__audio.currentTime=0},ZICA.Entity.prototype.__updateFromFixed=function(){var t=Game.camera;this.x=t.viewport.left+this.X,this.y=t.viewport.top+this.Y},ZICA.Entity.prototype.__updateFromAbsolute=function(){var t=Game.camera;this.X=-t.viewport.left+this.x,this.Y=-t.viewport.top+this.y},ZICA.Entity.prototype.calculateAspectRatio=function(){var t=Math.min(this.width/this.__image.width,this.height/this.__image.height);return{width:this.__image.width*t,height:this.__image.height*t}},ZICA.Entity.prototype.getCenter=function(){return{x:this.x+this.width/2,y:this.y+this.height/2}},ZICA.Entity.prototype.updateBounds=function(){this.halfWidth=.5*this.width,this.halfHeight=.5*this.height},ZICA.Entity.prototype.getMidX=function(){return this.halfWidth+this.x},ZICA.Entity.prototype.getMidY=function(){return this.halfHeight+this.y},ZICA.Entity.prototype.getTop=function(){return this.y},ZICA.Entity.prototype.getLeft=function(){return this.x},ZICA.Entity.prototype.getRight=function(){return this.x+this.width},ZICA.Entity.prototype.getBottom=function(){return this.y+this.height},ZICA.Entity.prototype.__getCollisionBounds=function(){return this.__collisionBounds},ZICA.Entity.prototype.__generateGUID=function(){function t(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return(t()+t()+"-"+t()+"-4"+t().substr(0,3)+"-"+t()+"-"+t()+t()+t()).toLowerCase()},ZICA.Entity.prototype.removeAnimator=function(t){var e=this.animators.indexOf(t);e&&this.animators.splice(e,1)},ZICA.Entity.prototype.addAnimator=function(t){"string"==typeof this.animators&&(this.animators=[]),t&&this.animators.push(t)},ZICA.Entity.prototype.getAnimatorOfType=function(t){if(this.animators.length)for(var e in this.animators)if(this.animators[e].getType()==t)return this.animators[e]},ZICA.Entity.prototype.cloneAnimators=function(){if(!Array.isArray(this.animators))return[];for(var t=[],e=0;e<this.animators.length;++e){var i=this.animators[e];null!=i&&t.push(i.createClone())}return t},ZICA.Entity.prototype.addAnimation=function(t){this.animations[t.id]=t},ZICA.Entity.prototype.createAnimation=function(t,e,i,n,o){var a={};return a.sy=t,a.width=e,a.height=i,a.frameCount=n,a.frame=0,a.id=o,a},ZICA.Entity.prototype.removeAnimation=function(t){return delete this.animations[t]},ZICA.Entity.prototype.getAnimationbyId=function(t){return this.animations[t]?this.animations[t]:null},ZICA.Entity.prototype.getAnimations=function(){var t=[];for(var e in t.push(""),this.animations)e&&t.push(e);return t},ZICA.Entity.prototype.setAnimation=function(t){this.animation=t,t&&(this.animations[t].frame=0)},ZICA.Entity.prototype.updateAnimation=function(){var t=this.animations[this.animation];t&&(t.frame>=t.frameCount-1&&0==this.animLoop||(t.frame=(t.frame+1)%t.frameCount))},ZICA.Entity.prototype.drawAnimation=function(t){var e=this.animations[this.animation];e&&t.drawImage(this.__image,e.frame*e.width,e.sy,e.width,e.height,this.x,this.y,this.width,this.height)},ZICA.Entity.constructEntity=function(t){var e=new ZICA.Entity;for(var i in t)if("__image"!==i){if("__on"==i.substring(0,4)&&"String"==i.substring(i.length-6)){var n=i.substring(0,i.lastIndexOf("String")),o=new Function("event",t[i]);e[n]=o}e[i]=t[i]}return e},ZICA.Keys={leftButton:1,middleButton:2,rightButton:3,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,zero:48,one:49,two:50,three:51,four:52,five:53,six:54,seven:55,eight:56,nine:57,numPadZero:96,numPadOne:97,numPadTwo:98,numPadThree:99,numPadFour:100,numPadFive:101,numPadSix:102,numPadSeven:103,numPadEight:104,numPadNine:105,numPadAsterisk:106,numPadPlus:107,numPadMinus:109,numPadPeriod:110,numPadForwardSlash:111,minus:189,equals:187,space:32,enter:13,shift:16,crtl:17,alt:18,tab:9,capsLock:20,backspace:8,escape:27,insert:45,delete:46,end:35,home:36,pageUp:33,pageDown:34,comma:188,period:190,forwardSlash:191,backSlash:220,semicolon:186,apostrophe:222,leftBracket:219,rightBracket:221,backTick:192,left:37,up:38,right:39,down:40},ZICA.Scene=function(){this.id=0,this.type="scene",this.isScene=!0,this.uId=this.__generateGUID(),this.name="",this.active=!1,this.gravity=10,this.x=0,this.y=0,this.useCamera=!1,this.width=400,this.height=400,this.drawMap=!0,this.map="",this.opacity=1,this.drawColor=!0,this.color="rgba(0,0,0,1)",this.drawImage=!0,this.aspectRatio=!1,this.image="",this.__image=new Image,this.__map=new Image,this.children=[],this.firstFrame=!0,this.animators="[]",this.animations={},this.__onGameStartString="",this.__onUpdateString="",this.__onCollisionString=""},ZICA.Scene.prototype.__generateGUID=function(){function t(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return(t()+t()+"-"+t()+"-4"+t().substr(0,3)+"-"+t()+"-"+t()+t()+t()).toLowerCase()},ZICA.Scene.prototype.addEntity=function(t){t&&this.children.push(t)},ZICA.Scene.prototype.removeEntity=function(t){for(var e=0;e<this.children.length;++e)if(this.children[e]===t)return void this.children.splice(e,1)},ZICA.Scene.prototype.getEntityByName=function(t){for(var e=0;e<this.children.length;++e)if(this.children[e].name===t)return this.children[e]},ZICA.Scene.prototype.getEntityByUID=function(t){for(var e=0;e<this.children.length;++e)if(this.children[e].__guid===t)return this.children[e]},ZICA.Scene.prototype.getEntity=function(t){for(var e=0;e<this.children.length;++e)if(e===t)return this.children[e]},ZICA.Scene.prototype.getEntitiesByName=function(t){for(var e=[],i=0;i<this.children.length;++i)this.children[i].name===t&&e.push(this.children[i]);return e},ZICA.Scene.prototype.duplicate=function(){var t=new ZICA.Scene;for(var e in this)if("object"==typeof this[e]){var i=JSON.parse(JSON.stringify(this[e]));t[e]=i}else t[e]=this[e];return t},ZICA.Scene.prototype.removeAnimator=function(t){var e=this.animators.indexOf(t);e&&this.animators.splice(e,1)},ZICA.Scene.prototype.addAnimator=function(t){t&&this.animators.push(t)},ZICA.Scene.prototype.getAnimatorOfType=function(t){if(this.animators.length)for(var e in this.animators)if(this.animators[e].getType()==t)return this.animators[e]},ZICA.Scene.prototype.moveCameraAt=function(t){if(t.isEntity)var e=t.getCenter();else e={x:t.x,y:t.y};this.x=e.x,this.y=e.y},ZICA.Scene.prototype.getCameraPostion=function(){return{x:this.x,y:this.y}},ZICA.Scene.prototype.__onGameStart=function(t){},ZICA.Scene.prototype.__onUpdate=function(t){},ZICA.Scene.prototype.__onCollision=function(t){},ZICA.Scene.prototype.__draw=function(t){var e=Game.camera;if(t.clearRect(0,0,t.canvas.width,t.canvas.height),this.beforeDraw&&this.beforeDraw.call(this,t),this.drawMap&&(this.__map instanceof Image==0&&(this.__map=new Image),this.__map.name!=this.map&&(this.__map.name=this.map,this.map?this.__map.src=this.map in Game.assets?Game.assets[this.map]:"":this.__map.src=""),t.drawImage(this.__map,0,0,this.width,this.height)),e.end(),t.globalAlpha=this.opacity,this.drawColor&&(t.fillStyle=this.color,t.fillRect(0,0,t.canvas.width,t.canvas.height)),this.drawImage)if(this.__image instanceof Image==0&&(this.__image=new Image),this.__image.name!=this.image&&(this.__image.name=this.image,this.image?this.__image.src=this.image in Game.assets?Game.assets[this.image]:"":this.__image.src=""),this.aspectRatio){var i=this.__image.naturalWidth,n=this.__image.naturalHeight,o=t.canvas,a=Math.min(o.width/i,o.height/n);t.save(),t.setTransform(a,0,0,a,o.width/2,o.height/2),t.drawImage(this.__image,-i/2,-n/2,i,n),t.restore()}else t.drawImage(this.__image,0,0,t.canvas.width,t.canvas.height);t.globalAlpha=1,e.begin(),this.afterDraw&&this.afterDraw.call(this,t)},ZICA.Scene.constructScene=function(t){var e=ZICA.Entity,i=new ZICA.Scene;for(var n in t)if("children"==n){i.children=[];for(var o=0;o<t.children.length;o++){var a=e.constructEntity(t.children[o]);i.children.push(a)}}else if(i[n]=t[n],"__on"==n.substring(0,4)&&"String"==n.substring(n.length-6)){var s=n.substring(0,n.lastIndexOf("String")),r=new Function("event",t[n]);i[s]=r}return i},ZICA.GameRunner=function(t){var e=this;this.name="",this.version="",this.author="",this.description="",this.assets={},this.autoSize=!1,this.autoResize=!1,this.pointerLock=!1,this.fullScreen=!1,this.icon="",this.logo="",this.showProgress=!0,window.p2=null,this.x=0,this.y=0,this.width=400,this.height=400,this.variables={},this.scene=null,this.scenes=[],this.__globalString="",this.__global=function(t){},this.entityList=[],this.state=ZICA.State.stopped,this.firstFrame=!0,this.startTime=0,this.controls=new ZICA.GameRunner.Controls,this.canvas=t,this.drawContext=t.getContext("2d"),this.width=t.width,this.height=t.height,t.tabIndex=1,t.focus(),this.drawContext.textBaseline="top",this.Keys=ZICA.Keys,this.intervals=[],t.addEventListener("keydown",function(t){e.onKeyDown(t)}),t.addEventListener("keyup",function(t){e.onKeyUp(t)}),t.addEventListener("keypress",function(t){e.onKeyPress(t)}),t.addEventListener("mousedown",function(t){e.onMouseDown(t)}),t.addEventListener("mouseup",function(t){e.onMouseUp(t)}),t.addEventListener("mousemove",function(t){e.onMouseMove(t)}),t.addEventListener("click",function(t){e.onMouseClick(t)}),t.addEventListener("touchstart",function(t){e.onMouseDown(t)}),t.addEventListener("touchend",function(t){e.onMouseUp(t)}),t.addEventListener("touchmove",function(t){e.onMouseMove(t)})},ZICA.GameRunner.prototype.startApp=function(){var t=this;if(this.state==ZICA.State.stopped){this.fullScreen&&this.fullscreen(),this.autoResize&&(this.canvas.style.height="100%",this.canvas.style.width="100%"),this.camera=new ZICA.Camera(this.drawContext),this.firstFrame=!0,this.entityList=this.scene.children,this.state=ZICA.State.running,this.tryUserFunc(function(){Game.__global(null)});var e=this.scene;p2&&(e.world=new p2.World({gravity:[0,e.gravity]})),this.tryUserFunc(function(){e.__onGameStart(null)});var i=function(t){n.tryUserFunc(function(){t.__onGameStart(null)})};this.tryUserFunc(function(){Game.initAnimators()});for(var n=this,o=0,a=this.entityList;o<a.length;o++){i(a[o])}this.resetTimer(),requestAnimationFrame(function(){t.update()})}},ZICA.GameRunner.prototype.startFromData=function(t){var e=this;e.constructor.constructApp(t,e),e.canvas.width=e.width,e.canvas.height=e.height,window.onresize=function(){e.resize()},e.resize(),document.body.style.background="none",e.progress&&e.progress.parentElement.removeChild(e.progress),e.startApp()},ZICA.GameRunner.prototype.startFromFile=function(t){var e=this,i=new XMLHttpRequest;i.open("GET",t,!0),i.onprogress=function(t){t.lengthComputable},i.onerror=function(t){e.progress&&(e.progress.innerHTML="<b>Error loading data!!!</b>",e.progress.className="error")},i.onreadystatechange=function(){if(4===i.readyState)if(200===i.status||0==i.status){var t=i.responseText,n=JSON.parse(t);e.constructor.constructApp(n,e),e.canvas.width=e.width,e.canvas.height=e.height,window.onresize=function(){e.resize()},e.resize(),document.body.style.background="none",e.progress&&e.progress.parentElement.removeChild(e.progress),e.startApp()}else i.onerror()},i.send(null)},ZICA.GameRunner.prototype.resize=function(){if(this.autoSize){var t=this.canvas.parentNode.getClientRects()[0];this.width=t.width,this.height=t.height,this.canvas.width=this.width,this.canvas.height=this.height}},ZICA.GameRunner.prototype.pauseSounds=function(t){t.pausedSongs=[];for(var e=0,i=t.children;e<i.length;e++){var n=i[e];n.__audio instanceof Audio&&(n.__audio.paused||(n.pauseAudio(),t.pausedSongs.push(n)))}},ZICA.GameRunner.prototype.resumeSounds=function(t){if(t.pausedSongs)for(var e=0;e<=t.pausedSongs.length-1;e++)t.pausedSongs[e].playAudio();t.pausedSongs=[]},ZICA.GameRunner.prototype.stopSounds=function(t){t.pausedSongs=[];for(var e=0,i=t.children;e<i.length;e++){var n=i[e];n.__audio instanceof Audio&&(n.stopAudio(),n.__audio=null)}},ZICA.GameRunner.prototype.stopAllSounds=function(){var t=this.scene;t.pausedSongs=[];for(var e=0,i=t.children;e<i.length;e++){var n=i[e];n.__audio instanceof Audio&&n.stopAudio()}},ZICA.GameRunner.prototype.stop=function(){this.state=ZICA.State.stopped,this.stopSounds(this.scene),this.controls.keyData={},this.controls.mouse={},this.clearIntervals()},ZICA.GameRunner.prototype.pause=function(){this.state==ZICA.State.running&&(this.state=ZICA.State.paused,this.pauseSounds(this.scene))},ZICA.GameRunner.prototype.unpause=function(){this.state==ZICA.State.paused&&(this.state=ZICA.State.running,this.resumeSounds(this.scene))},ZICA.GameRunner.prototype.isRunning=function(){return this.state==ZICA.State.running},ZICA.GameRunner.prototype.isPaused=function(){return this.state==ZICA.State.paused},ZICA.GameRunner.prototype.isStopped=function(){return this.state==ZICA.State.stopped},ZICA.GameRunner.prototype.update=function(){if(this.preventDefault)this.preventDefault=!1;else{var t=this;if(this.isRunning()){this.pointerLock&&2==this.state?this.canvas.style.cursor="none":this.canvas.style.cursor="",this.camera.set(this.scene.x,this.scene.y),this.scene.__draw(this.drawContext);var e=this.scene,i=this.updateTimer();this.tryUserFunc(function(){e.__onUpdate(i)}),this.tryUserFunc(function(){t.updateAnimators(e,i)});var n=i.deltaTime;e.world&&e.world.step(1/60,n,10)}if(this.isRunning()){i=this.currentTimer();for(var o=0;o<this.entityList.length;o++){var a=this.entityList[o];a.__removeFlag||(this.tryUserFunc(function(){t.entityList[o].__onUpdate(i)}),this.tryUserFunc(function(){t.updateAnimators(t.entityList[o],i)})),a.__removeFlag&&(this.entityList.splice(o,1),o--)}this.moveAndCollideEntities()}var s=this.entityList.slice();this.recalcPriority(s);for(var r=0,h=s;r<h.length;r++){h[r].__draw(this.drawContext)}this.controls.updateKeyData(),this.firstFrame=!1,this.scene.firstFrame=!1,this.isStopped()?this.drawContext.clearRect(0,0,this.canvas.width,this.canvas.height):requestAnimationFrame(function(){t.update()})}},ZICA.GameRunner.prototype.cloneEntity=function(t){if(!t)return null;var e=t.cloneAnimators(),i=t.constructor.constructEntity(t);return i.__guid=i.__generateGUID(),i.animators=e,Game.entityList.push(i),i},ZICA.GameRunner.prototype.addEntity=function(t){this.entityList.push(t)},ZICA.GameRunner.prototype.recalcPriority=function(t){t.sort(function(t,e){return t.priority-e.priority})},ZICA.GameRunner.prototype.getEntityByName=function(t){for(var e=0,i=this.entityList;e<i.length;e++){var n=i[e];if(n.name===t)return n}return null},ZICA.GameRunner.prototype.getEntityById=function(t){if(1==t)return Game.scene;for(var e=0,i=this.entityList;e<i.length;e++){var n=i[e];if(n.__guid===t)return n}return null},ZICA.GameRunner.prototype.getEntitiesByName=function(t){for(var e=[],i=0,n=this.entityList;i<n.length;i++){var o=n[i];o.name===t&&e.push(o)}return e},ZICA.GameRunner.prototype.addScene=function(t){t&&this.scenes.push(t)},ZICA.GameRunner.prototype.setActiveScene=function(t){if(t){for(var e=0;e<this.scenes.length;++e)this.scenes[e].active=!1;this.scene=t,this.scene.active=!0}},ZICA.GameRunner.prototype.removeScene=function(t){for(var e=0;e<this.scenes.length;++e)if(this.scenes[e]===t)return void this.scenes.splice(e,1)},ZICA.GameRunner.prototype.resetScene=function(t){var e=this.scenes.indexOf(t);return this.scenes[e]=ZICA.Scene.constructScene(this.backupScenes[e]),this.scenes[e]},ZICA.GameRunner.prototype.switchToScene=function(t,e){var i=this;if(this.preventDefault=!0,this.backupSceneTimer(this.scene),this.pauseSounds(this.scene),e&&(t=this.resetScene(t)),this.controls=new ZICA.GameRunner.Controls,this.setActiveScene(t),this.entityList=this.scene.children,0==this.scene.firstFrame)return this.backupTimer(t),this.resumeSounds(t),void requestAnimationFrame(function(){i.update()});this.stopSounds(this.scene),this.state=ZICA.State.running;t=this.scene;this.tryUserFunc(function(){t.__onGameStart(null)});var n=function(t){o.tryUserFunc(function(){t.__onGameStart(null)})};this.tryUserFunc(function(){Game.initAnimators()});for(var o=this,a=0,s=this.entityList;a<s.length;a++){n(s[a])}this.resetTimer(),requestAnimationFrame(function(){i.update()})},ZICA.GameRunner.prototype.getSceneByName=function(t){for(var e=0;e<this.scenes.length;++e)if(this.scenes[e].name===t)return this.scenes[e]},ZICA.GameRunner.prototype.getScene=function(t){for(var e=0;e<this.scenes.length;++e)if(e===t)return this.scenes[e]},ZICA.GameRunner.prototype.setVariable=function(t,e){this.variables[t]=e},ZICA.GameRunner.prototype.getVariable=function(t){return this.variables[t]},ZICA.GameRunner.prototype.hasVariable=function(t){return!!this.variables[t]},ZICA.GameRunner.prototype.removeVariable=function(t){return delete this.variables[t]},ZICA.GameRunner.prototype.pointInBox=function(t,e){return t.x>e.x&&t.x<e.x+e.width&&t.y>e.y&&t.y<e.y+e.height},ZICA.GameRunner.prototype.boxInBox=function(t,e){return e.x>t.x&&e.y>t.y&&e.x+e.width<t.x+t.width&&e.y+e.height<t.y+t.height},ZICA.GameRunner.prototype.updateTimer=function(){var t=new Date;return this.timeElapsed+=this.deltaTime,this.deltaTime=t-this.startTime,this.startTime=t,{delta:this.deltaTime,timeElapsed:this.timeElapsed}},ZICA.GameRunner.prototype.resetTimer=function(){this.startTime=new Date,this.timeElapsed=0,this.deltaTime=0},ZICA.GameRunner.prototype.currentTimer=function(){return{delta:this.deltaTime,timeElapsed:this.timeElapsed}},ZICA.GameRunner.prototype.backupSceneTimer=function(t){t.timeElapsed=this.timeElapsed},ZICA.GameRunner.prototype.backupTimer=function(t){this.timeElapsed=t.timeElapsed},ZICA.GameRunner.prototype.print=function(t){window.parent.Editor&&(window.parent.Editor.clearConsole(),window.parent.Editor.log(t))},ZICA.GameRunner.prototype.log=function(t){window.parent.Editor&&window.parent.Editor.log(t)},ZICA.GameRunner.prototype.error=function(t){window.parent.Editor&&window.parent.Editor.error(t)},ZICA.GameRunner.prototype.clearConsole=function(){window.parent.Editor&&window.parent.Editor.clearConsole()},ZICA.GameRunner.prototype.fullscreen=function(){var t=this.canvas;t.RequestFullScreen?t.RequestFullScreen():t.webkitRequestFullScreen?t.webkitRequestFullScreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.msRequestFullscreen?t.msRequestFullscreen():alert("This browser doesn't supporter fullscreen")},ZICA.GameRunner.prototype.exitFullscreen=function(){this.canvas;document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():alert("Exit fullscreen doesn't work")},ZICA.GameRunner.prototype.switchFullscreen=function(){document.fullscreenElement&&null!==document.fullscreenElement||document.webkitFullscreenElement&&null!==document.webkitFullscreenElement||document.mozFullScreenElement&&null!==document.mozFullScreenElement||document.msFullscreenElement&&null!==document.msFullscreenElement?this.exitFullscreen():this.fullscreen()},ZICA.GameRunner.prototype.setInterval=function(t,e,i){if("function"==typeof t&&(e=Number(e)))return this.intervals.push(setInterval(function(){t.call(i)},e))},ZICA.GameRunner.prototype.clearIntervals=function(){for(var t=0;t<=this.intervals.length-1;t++)clearInterval(this.intervals[t]);this.intervals.length=0},ZICA.GameRunner.prototype.clearInterval=function(t){clearInterval(t)},ZICA.GameRunner.prototype.moveAndCollideEntities=function(){this.step(.05),this.CollideEntities()},ZICA.GameRunner.prototype.collideRect=function(t,e){var i=t.getLeft(),n=t.getTop(),o=t.getRight(),a=t.getBottom(),s=e.getLeft(),r=e.getTop(),h=e.getRight(),c=e.getBottom();return!(a<r||n>c||o<s||i>h)},ZICA.GameRunner.prototype.resolveElastic=function(t,e){var i=t.getMidX(),n=t.getMidY(),o=e.getMidX(),a=e.getMidY(),s=(o-i)/e.halfWidth,r=(a-n)/e.halfHeight,h=Math.abs(s),c=Math.abs(r);Math.abs(h-c)<.1?(t.x=s<0?e.getRight():e.getLeft()-t.width,t.y=r<0?e.getBottom():e.getTop()-t.height,Math.random()<.5?(t.velX=-t.velX*e.restitution,Math.abs(t.velX)<4e-4&&(t.velX=0)):(t.velY=-t.velY*e.restitution,Math.abs(t.velY)<4e-4&&(t.velY=0))):h>c?(t.x=s<0?e.getRight():e.getLeft()-t.width,t.velX=-t.velX*e.restitution,Math.abs(t.velX)<4e-4&&(t.velX=0)):(t.y=r<0?e.getBottom():e.getTop()-t.height,t.velY=-t.velY*e.restitution,Math.abs(t.velY)<4e-4&&(t.velY=0))},ZICA.GameRunner.prototype.step=function(t){for(var e,i=this.scene.gravity*t,n=this.entityList,o=0,a=n.length;o<a;o++){switch((e=n[o]).physicType){case"dynamic":e.velX+=e.ax*t+0,e.velY+=e.ay*t+i,e.x+=e.velX*t,e.y+=e.velY*t;break;case"kinematic":e.velX+=e.ax*t,e.velY+=e.ay*t,e.x+=e.velX*t,e.y+=e.velY*t}e.updateBounds()}},ZICA.GameRunner.prototype.CollideEntities=function(){for(var t=0;t<this.entityList.length;t++){var e=this.entityList[t];if(e.collides)for(var i=t+1;i<this.entityList.length;i++){var n=this.entityList[i];if(n.collides&&this.collideRect(e,n)){var o,a={other:n},s={other:e};e.collision,this.tryUserFunc(function(){e.__onCollision(a)}),this.tryUserFunc(function(){n.__onCollision(s)}),(o=a).name="onCollision",Game.handleEvent(e,o),(o=s).name="onCollision",Game.handleEvent(n,o)}}}},ZICA.GameRunner.prototype.tryUserFunc=function(t){try{t()}catch(t){console.log(t),Game.error(t),this.stop()}},ZICA.GameRunner.prototype.getMouse=function(t){var e={x:0,y:0},i=this.canvas,n=i.getBoundingClientRect();return e.x=t.clientX-n.left,e.y=t.clientY-n.top,e.x/=n.width,e.y/=n.height,e.x*=i.width,e.y*=i.height,e},ZICA.GameRunner.prototype.handleMouseEvent=function(t){var e={};e.x=this.controls.mouse.x,e.y=this.controls.mouse.y,e.key=t.which;var i=t.type;this.autoResize&&(e.x=this.getMouse(t).x,e.y=this.getMouse(t).y);var n=this.camera.screenToWorld(e.x,e.y);e.x=n.x,e.y=n.y,t=e,"mousedown"==i&&(this.mouseBuffer=[]);for(var o=-1,a=this.entityList;o<a.length;o++){if(o<0)var s=this.scene,r=!0;else s=a[o],r=this.pointInBox(e,s);r?("mousedown"==i&&(s.onmousedown&&s.onmousedown.call(s,e),t.name="onMouseDown",Game.handleEvent(s,t),this.mouseBuffer.push(s)),"mouseup"==i&&(s.onmouseup&&s.onmouseup.call(s,e),t.name="onMouseUp",Game.handleEvent(s,t),this.mouseBuffer.includes(s)&&(e.type="click",s.onclick&&s.onclick.call(s,e),t.name="onClick",Game.handleEvent(s,t))),"mousemove"==i&&(s.onmouseover&&s.onmouseover.call(s,e),t.name="onMouseOver",Game.handleEvent(s,t))):"mousemove"==i&&(s.onmouseout&&s.onmouseout.call(s,e),t.name="onMouseOut",Game.handleEvent(s,t))}},ZICA.GameRunner.prototype.handleKeyEvent=function(t){for(var e=t.which,i=t.type,n=-1,o=this.entityList;n<o.length;n++){if(n<0)var a=this.scene;else a=o[n];"keyup"==i&&(a.onkeyup&&a.onkeyup.call(a,e),t.name="onKeyUp",Game.handleEvent(a,t)),"keydown"==i&&(a.onkeydown&&a.onkeydown.call(a,e),t.name="onKeyDown",Game.handleEvent(a,t)),"keypress"==i&&(a.onkeypress&&a.onkeypress.call(a,e),t.name="onKeyPress",Game.handleEvent(a,t))}},ZICA.GameRunner.prototype.onKeyDown=function(t){this.isRunning()&&(this.controls.handleKeyEvent(t,!0),this.handleKeyEvent(t))},ZICA.GameRunner.prototype.onKeyUp=function(t){this.isRunning()&&(this.controls.handleKeyEvent(t,!1),this.handleKeyEvent(t))},ZICA.GameRunner.prototype.onKeyPress=function(t){this.isRunning()&&this.handleKeyEvent(t)},ZICA.GameRunner.prototype.onMouseDown=function(t){this.isRunning()&&(this.handleMouseEvent(t),this.controls.handleKeyEvent(t,!0))},ZICA.GameRunner.prototype.onMouseUp=function(t){this.isRunning()&&(this.handleMouseEvent(t),this.controls.handleKeyEvent(t,!1))},ZICA.GameRunner.prototype.onMouseMove=function(t){this.isRunning()&&(this.handleMouseEvent(t),this.controls.handleMouseMoveEvent(t))},ZICA.GameRunner.prototype.onMouseClick=function(t){this.isRunning()&&this.handleMouseEvent(t)},ZICA.GameRunner.prototype.initAnimators=function(){for(var this_1=this,_i=-1,_a=this.entityList;_i<_a.length;_i++){if(_i<0)var ent=this.scene;else var ent=_a[_i];var code=ent.animators;"string"==typeof code&&(ent.animators=[],eval(this.BehsToCode(JSON.parse(code))))}},ZICA.GameRunner.prototype.updateAnimators=function(t,e){for(var i=0;i<t.animators.length;i++)t.animators[i].animateNode(t,e)},ZICA.GameRunner.prototype.handleEvent=function(t,e){for(var i=0;i<t.animators.length;i++)t.animators[i][e.name](e,t)},ZICA.GameRunner.prototype.BehsToCode=function(t){var e="";for(var i in t)if(t[i].jsname){for(var n in e+="ent.animators.push(new ZICA."+t[i].jsname+"({",t[i])Array.isArray(t[i][n])&&(e+="'"+n+"':"+this.replaceAttr(t[i][n][0],t[i][n][1],t[i][n][2])+",");e=e.substring(0,e.length-1),e+="}));\n"}return e},ZICA.GameRunner.prototype.ActsToCode=function(t){var e="";for(var i in e+="new ZICA.ActionHandler([",t)if(t[i].jsname){for(var n in e+="new ZICA.Action."+t[i].jsname+"({",t[i])Array.isArray(t[i][n])&&(e+="'"+n+"':"+this.replaceAttr(t[i][n][0],t[i][n][1],t[i][n][2])+",");e=e.substring(0,e.length-1),e+="}),"}return","==e[e.length-1]&&(e=e.substring(0,e.length-1)),e+="])"},ZICA.GameRunner.prototype.replaceAttr=function(t,e,i){return"int"==t||"float"==t||"slider"==t?Number(e):"bool"==t?e:"string"==t?JSON.stringify(e):"image"==t?JSON.stringify(e):"color"==t?JSON.stringify(e):"vect3d"==t?"new ZICA.Vect3d("+JSON.parse(e)[0]+","+JSON.parse(e)[1]+","+JSON.parse(e)[2]+")":"vect2d"==t?"new ZICA.Vect2d("+JSON.parse(e)[0]+","+JSON.parse(e)[1]+")":"action"==t?this.ActsToCode(e):"combo"==t?JSON.stringify(e):"propcombo"==t?JSON.stringify(e):"array"==t?JSON.stringify(e):"audio"==t?JSON.stringify(e):"animation"==t?JSON.stringify(e):"scene"==t?JSON.stringify(e):"node"==t?i?JSON.stringify(i):"null":"hidden"==t?JSON.stringify(e):void 0},ZICA.GameRunner.constructApp=function(t,e){var i=["name","version","author","description","width","height","__globalString","assets","autoSize","autoResize","pointerLock","fullScreen","icon","logo","showProgress"],n={};e&&(n=e);for(var o in t)if("scenes"==o){n.scenes=[],n.backupScenes=[];for(var a=0;a<t.scenes.length;a++){var s=ZICA.Scene.constructScene(t.scenes[a]),r=ZICA.Scene.constructScene(t.scenes[a]);n.scenes.push(s),n.backupScenes.push(r),s.active&&(n.scene=s)}}else-1!=i.indexOf(o)&&(n[o]=t[o]),t&&"__globalString"==o&&(n.__global=new Function("event",t[o]));return n},ZICA.GameRunner.Controls=function(){this.keyData={},this.mouse={x:0,y:0}},ZICA.GameRunner.Controls.prototype.isHeld=function(t){return"number"!=typeof t&&(t=ZICA.Keys[t]),t in this.keyData&&this.keyData[t].pressed},ZICA.GameRunner.Controls.prototype.isHeldOneFrame=function(t){if("number"!=typeof t&&(t=ZICA.Keys[t]),t in this.keyData){var e=this.keyData[t];return e.pressed&&!e.wasPressed}return!1},ZICA.GameRunner.Controls.prototype.updateKeyData=function(){for(var t in this.keyData){var e=this.keyData[t];e.wasPressed=e.pressed}},ZICA.GameRunner.Controls.prototype.handleKeyEvent=function(t,e){t.which in this.keyData?this.keyData[t.which].pressed=e:this.keyData[t.which]={pressed:e,wasPressed:!1}},ZICA.GameRunner.Controls.prototype.handleMouseMoveEvent=function(t){var e={x:0,y:0},i=t.currentTarget;t.touches?t.touches.length&&(e.x=parseInt(t.touches[0].pageX),e.y=parseInt(t.touches[0].pageY)):(e.x=parseInt(t.clientX),e.y=parseInt(t.clientY));var n=i.getBoundingClientRect();e.x+=i.scrollLeft-i.clientLeft-n.left,e.y+=i.scrollTop-i.clientTop-n.top,this.mouse.x=e.x,this.mouse.y=e.y};